-- https://github.com/pasalas/GA_POM_queries/blob/main/motors_matt_seguimiento_total

-- vertical: MOTORS
-- foco de categoria: motors | autos y camionetas
-- foco de canales: macro | grouped attribution | pom vis subgroup | xps

-- nota: el scrip est√° para verlo diariamente
-- para cambiar a otro periodo buscar y reemplazar: DAY) AS period
-- mensual: MONTH) AS period
-- semanal: ISOWEEK) AS period
-- anual: YEAR) AS period

DECLARE fecha_desde DATE DEFAULT '2023-12-01'
;
DECLARE fecha_hasta DATE DEFAULT '2023-12-05'
;

DECLARE parametro_vertical STRING DEFAULT '1743' -- 1459
;

--ingresar los sites a consultar
DECLARE var_sites ARRAY <STRING>;

-- MOTORS o REAL ESTATE y PORTAL INMOBILIARI
DECLARE var_matt_vertical ARRAY <STRING>;


SET var_sites = ['MLB'];

-- para que en touchpoints y costos solo se consideren los de la vertical, y para calcular el desvio en leads
SET var_matt_vertical = ['MOTORS']; -- 'REAL ESTATE','PORTAL INMOBILIARIO','MOTORS'


WITH generic_pom_vis AS
(
  SELECT
    (CASE WHEN UPPER(matt_vertical) IN ('REAL ESTATE','PORTAL INMOBILIARIO') THEN 'real estate'
          WHEN UPPER(matt_vertical) = 'MOTORS' THEN 'motors'
          ELSE UPPER(matt_vertical) END) AS vertical

  , `meli-bi-data.SBOX_MKTVIS`.fx_bt_vis_matt_inbound_grouped_attribution(matt_vertical, matt_campaign_type, matt_implementation_channel, matt_implementation_source, matt_implementation, matt_tool) AS is_POM_VIS

  , `meli-bi-data.SBOX_MKTVIS`.fx_bt_vis_matt_inbound_pom_vis_subgroup(matt_vertical, matt_campaign_type, matt_implementation_channel, matt_implementation_source, matt_implementation, matt_tool)  AS POM_VIS_subgroup

  , `meli-bi-data.SBOX_MKTVIS`.fx_pom_vis_experimentos(matt_vertical, matt_campaign_type, matt_implementation_channel, matt_implementation_source, matt_implementation, matt_tool) AS experimentos

  , MATT_TOOL
  , * EXCEPT(MATT_TOOL)

  FROM `meli-bi-data.WHOWNER.BT_MATT_METADATA` AS H

  WHERE MATT_BUSINESS_UNIT = 'VIS' -- para traer todas las tool ids flagueadas como VIS
  AND SIT_SITE_ID IN UNNEST(var_sites)
  AND TIM_DAY = CURRENT_DATE

  -- QUALIFY ROW_NUMBER() OVER (PARTITION BY MATT_TOOL ORDER BY TIM_DAY DESC) = 1 -- traigo solo la ultima foto de cada tool id
)

, matt_inbound AS
(
  SELECT
      A.sit_site_id
    , DATE_TRUNC(ds_date, DAY) AS period -- DATE_TRUNC(ds_date, MONTH) DATE_TRUNC(ds_date, ISOWEEK) 
      ------------------------------------------------
      ---- POM VIS
      ------------------------------------------------
        , COUNT(
            DISTINCT
            IF(
                is_POM_VIS = 'POM VIS'  
              , COALESCE(cus_cust_id, uid)
              , NULL ) ) AS pom_vis_user_touch_point

        , COUNT(
            DISTINCT
            IF(
                is_POM_VIS = 'POM VIS'  
            AND cus_cust_id IS NOT NULL
              , cus_cust_id
              , NULL ) ) AS pom_vis_user_logg_touch_point
        , COUNT(
            DISTINCT
            IF(
                is_POM_VIS = 'POM VIS'  
            AND cus_cust_id IS NULL    
              , uid
              , NULL ) ) AS pom_vis_user_not_logg_touch_point

      ------------------------------------------------
      ---- POM VIS GOOGLE SEARCH
      ------------------------------------------------
        , COUNT(
            DISTINCT
            IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('GOOGLE SEARCH')
              , COALESCE(cus_cust_id, uid)
              , NULL ) ) AS pom_vis_google_search_user_touch_point

        , COUNT(
            DISTINCT
            IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('GOOGLE SEARCH')
            AND cus_cust_id IS NOT NULL
              , cus_cust_id
              , NULL ) ) AS pom_vis_google_search_user_logg_touch_point
        , COUNT(
            DISTINCT
            IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('GOOGLE SEARCH')
            AND cus_cust_id IS NULL    
              , uid
              , NULL ) ) AS pom_vis_google_search_user_not_logg_touch_point

      ------------------------------------------------
      ---- POM VIS GOOGLE DISPLAY
      ------------------------------------------------
        , COUNT(
            DISTINCT
            IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('GOOGLE DISPLAY')
              , COALESCE(cus_cust_id, uid)
              , NULL ) ) AS pom_vis_google_display_user_touch_point

        , COUNT(
            DISTINCT
            IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('GOOGLE DISPLAY')
            AND cus_cust_id IS NOT NULL
              , cus_cust_id
              , NULL ) ) AS pom_vis_google_display_user_logg_touch_point

        , COUNT(
            DISTINCT
            IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('GOOGLE DISPLAY')
            AND cus_cust_id IS NULL    
              , uid
              , NULL ) ) AS pom_vis_google_display_user_not_logg_touch_point

      ------------------------------------------------
      ---- POM VIS FACEBOOK
      ------------------------------------------------
        , COUNT(
            DISTINCT
            IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('FACEBOOK')
              , COALESCE(cus_cust_id, uid)
              , NULL ) ) AS pom_vis_facebook_user_touch_point

        , COUNT(
            DISTINCT
            IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('FACEBOOK')
            AND cus_cust_id IS NOT NULL
              , cus_cust_id
              , NULL ) ) AS pom_vis_facebook_user_logg_touch_point

        , COUNT(
            DISTINCT
            IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('FACEBOOK')
            AND cus_cust_id IS NULL    
              , uid
              , NULL ) ) AS pom_vis_facebook_user_not_logg_touch_point

      ------------------------------------------------
      ---- POM VIS FACEBOOK FORMS
      ------------------------------------------------
        , COUNT(
            DISTINCT
            IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('FACEBOOK FORMS')
              , COALESCE(cus_cust_id, uid)
              , NULL ) ) AS pom_vis_facebook_forms_user_touch_point

        , COUNT(
            DISTINCT
            IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('FACEBOOK FORMS')
            AND cus_cust_id IS NOT NULL
              , cus_cust_id
              , NULL ) ) AS pom_vis_facebook_forms_user_logg_touch_point

        , COUNT(
            DISTINCT
            IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('FACEBOOK FORMS')
            AND cus_cust_id IS NULL    
              , uid
              , NULL ) ) AS pom_vis_facebook_forms_user_not_logg_touch_point

      ------------------------------------------------
      ---- POM VIS RTB
      ------------------------------------------------
        , COUNT(
            DISTINCT
            IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('RTB')
              , COALESCE(cus_cust_id, uid)
              , NULL ) ) AS pom_vis_rtb_user_touch_point

        , COUNT(
            DISTINCT
            IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('RTB')
            AND cus_cust_id IS NOT NULL
              , cus_cust_id
              , NULL ) ) AS pom_vis_rtb_user_logg_touch_point

        , COUNT(
            DISTINCT
            IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('RTB')
            AND cus_cust_id IS NULL    
              , uid
              , NULL ) ) AS pom_vis_rtb_user_not_logg_touch_point
            
      ------------------------------------------------
      ---- POM VIS OTHER
      ------------------------------------------------
        , COUNT(
            DISTINCT
            IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('other')
              , COALESCE(cus_cust_id, uid)
              , NULL ) ) AS pom_vis_other_user_touch_point

        , COUNT(
            DISTINCT
            IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('other')
            AND cus_cust_id IS NOT NULL
              , cus_cust_id
              , NULL ) ) AS pom_vis_other_user_logg_touch_point

        , COUNT(
            DISTINCT
            IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('other')
            AND cus_cust_id IS NULL    
              , uid
              , NULL ) ) AS pom_vis_other_user_not_logg_touch_point
          
      ------------------------------------------------
      ---- EXP: 01. contact user | A. con exclusion
      ------------------------------------------------
        , COUNT(
            DISTINCT
            IF(
                is_POM_VIS = 'POM VIS'  
            AND experimentos IN ('01. contact user | A. con exclusion')
              , COALESCE(cus_cust_id, uid)
              , NULL ) ) AS pom_vis_xp_contact_user_con_exclusion_user_touch_point

        , COUNT(
            DISTINCT
            IF(
                is_POM_VIS = 'POM VIS'  
            AND experimentos IN ('01. contact user | A. con exclusion')
            AND cus_cust_id IS NOT NULL
              , cus_cust_id
              , NULL ) ) AS pom_vis_xp_contact_user_con_exclusion_user_logg_touch_point

        , COUNT(
            DISTINCT
            IF(
                is_POM_VIS = 'POM VIS'  
            AND experimentos IN ('01. contact user | A. con exclusion')
            AND cus_cust_id IS NULL    
              , uid
              , NULL ) ) AS pom_vis_xp_contact_user_con_exclusion_user_not_logg_touch_point

      ------------------------------------------------
      ---- EXP: 01. contact user | B. sin exclusion
      ------------------------------------------------
        , COUNT(
            DISTINCT
            IF(
                is_POM_VIS = 'POM VIS'  
            AND experimentos IN ('01. contact user | B. sin exclusion')
              , COALESCE(cus_cust_id, uid)
              , NULL ) ) AS pom_vis_xp_contact_user_sin_exclusion_user_touch_point

        , COUNT(
            DISTINCT
            IF(
                is_POM_VIS = 'POM VIS'  
            AND experimentos IN ('01. contact user | B. sin exclusion')
            AND cus_cust_id IS NOT NULL
              , cus_cust_id
              , NULL ) ) AS pom_vis_xp_contact_user_sin_exclusion_user_logg_touch_point

        , COUNT(
            DISTINCT
            IF(
                is_POM_VIS = 'POM VIS'  
            AND experimentos IN ('01. contact user | B. sin exclusion')
            AND cus_cust_id IS NULL    
              , uid
              , NULL ) ) AS pom_vis_xp_contact_user_sin_exclusion_user_not_logg_touch_point

  FROM `meli-bi-data.SBOX_MKTVIS.BT_VIS_MATT_INBOUND` AS A

  -- traigo tools asociadas a VIS
  LEFT JOIN generic_pom_vis AS POM_GEN
  ON A.matt_tool = POM_GEN.matt_tool

  WHERE ds_date BETWEEN fecha_desde AND fecha_hasta
  AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)

  GROUP BY 1,2
  )

, matt_attribution AS
(
  SELECT
      (CASE WHEN B.cat_categ_id_l1 = '1459' THEN 'real estate' WHEN B.cat_categ_id_l1 = '1743' THEN 'motors' WHEN B.cat_categ_id_l1 = '1540' THEN 'services' END) AS vertical
    , A.sit_site_id
    , DATE_TRUNC(lead_created_dt, DAY) AS period -- DATE_TRUNC(lead_created_dt, MONTH) DATE_TRUNC(lead_created_dt, ISOWEEK) 

      ------------------------------------------------
      ---- TOTAL (sin apertura de canal)
      ------------------------------------------------
        -- contact timedecay
        , COUNT(DISTINCT LEAD_ID) AS total_motors_contact

        -- usuarios que contactaron
        , COUNT(
            DISTINCT
             COALESCE(CAST(A.CUS_CUST_ID_BUY AS STRING), B.SESSION_ID)
              ) AS total_motors_user_contact

        -- usuarios logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
                A.CUS_CUST_ID_BUY IS NOT NULL
              , A.CUS_CUST_ID_BUY
              , NULL) ) AS total_motors_user_logg_contact

        -- usuarios no logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
                A.CUS_CUST_ID_BUY IS NULL
              , B.SESSION_ID
              , NULL) ) AS total_motors_user_not_logg_contact

        -- items contactados
        , COUNT(
            DISTINCT
                  lead_item_id
             ) AS total_motors_item_contacted

        -- sellers contactados
        , COUNT(
            DISTINCT
              B.cus_cust_id_sel
              ) AS total_motors_seller_contacted
      ------------------------------------------------
      ---- POM VIS
      ------------------------------------------------
        -- contact timedecay
        , SAFE_DIVIDE( 
            SUM(IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'POM VIS'
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            , MATT_PORC_TIMEDECAY
            , NULL) )
          , 100) AS pom_vis_motors_timedecay_contact_attribution

        -- usuarios que contactaron
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'POM VIS'
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
              , COALESCE(CAST(A.CUS_CUST_ID_BUY AS STRING), B.SESSION_ID)
              , NULL) ) AS pom_vis_motors_user_contact

        -- usuarios logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'POM VIS'
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND A.CUS_CUST_ID_BUY IS NOT NULL
              , A.CUS_CUST_ID_BUY
              , NULL) ) AS pom_vis_motors_user_logg_contact

        -- usuarios no logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'POM VIS'
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND A.CUS_CUST_ID_BUY IS NULL
              , B.SESSION_ID
              , NULL) ) AS pom_vis_motors_user_not_logg_contact

        -- items contactados
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'POM VIS'
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
              , lead_item_id
              , NULL) ) AS pom_vis_motors_item_contacted

        -- sellers contactados
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'POM VIS'
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
              , B.cus_cust_id_sel
              , NULL) ) AS pom_vis_motors_seller_contacted

      ------------------------------------------------
      ---- DIRECT
      ------------------------------------------------
        -- contact timedecay
        , SAFE_DIVIDE( 
            SUM(IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'DIRECT'
            , MATT_PORC_TIMEDECAY
            , NULL) )
          , 100) AS direct_motors_timedecay_contact_attribution

        -- usuarios que contactaron
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'DIRECT'
              , COALESCE(CAST(A.CUS_CUST_ID_BUY AS STRING), B.SESSION_ID)
              , NULL) ) AS direct_motors_user_contact

        -- usuarios logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'DIRECT'
            AND A.CUS_CUST_ID_BUY IS NOT NULL
              , A.CUS_CUST_ID_BUY
              , NULL) ) AS direct_motors_user_logg_contact

        -- usuarios no logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'DIRECT'
            AND A.CUS_CUST_ID_BUY IS NULL
              , B.SESSION_ID
              , NULL) ) AS direct_motors_user_not_logg_contact

        -- items contactados
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'DIRECT'
              , lead_item_id
              , NULL) ) AS direct_motors_item_contacted

        -- sellers contactados
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'DIRECT'
              , B.cus_cust_id_sel
              , NULL) ) AS direct_motors_seller_contacted

      ------------------------------------------------
      ---- SEO
      ------------------------------------------------
        -- contact timedecay
        , SAFE_DIVIDE( 
            SUM(IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'SEO'
            , MATT_PORC_TIMEDECAY
            , NULL) )
          , 100) AS seo_motors_timedecay_contact_attribution

        -- usuarios que contactaron
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'SEO'
              , COALESCE(CAST(A.CUS_CUST_ID_BUY AS STRING), B.SESSION_ID)
              , NULL) ) AS seo_motors_user_contact

        -- usuarios logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'SEO'
            AND A.CUS_CUST_ID_BUY IS NOT NULL
              , A.CUS_CUST_ID_BUY
              , NULL) ) AS seo_motors_user_logg_contact

        -- usuarios no logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'SEO'
            AND A.CUS_CUST_ID_BUY IS NULL
              , B.SESSION_ID
              , NULL) ) AS seo_motors_user_not_logg_contact

        -- items contactados
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'SEO'
              , lead_item_id
              , NULL) ) AS seo_motors_item_contacted

        -- sellers contactados
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'SEO'
              , B.cus_cust_id_sel
              , NULL) ) AS seo_motors_seller_contacted
      ------------------------------------------------
      ---- OWN CHANNELS
      ------------------------------------------------
        -- contact timedecay
        , SAFE_DIVIDE( 
            SUM(IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'OWN CHANNELS'
            , MATT_PORC_TIMEDECAY
            , NULL) )
          , 100) AS own_channels_motors_timedecay_contact_attribution

        -- usuarios que contactaron
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'OWN CHANNELS'
              , COALESCE(CAST(A.CUS_CUST_ID_BUY AS STRING), B.SESSION_ID)
              , NULL) ) AS own_channels_motors_user_contact

        -- usuarios logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'OWN CHANNELS'
            AND A.CUS_CUST_ID_BUY IS NOT NULL
              , A.CUS_CUST_ID_BUY
              , NULL) ) AS own_channels_motors_user_logg_contact

        -- usuarios no logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'OWN CHANNELS'
            AND A.CUS_CUST_ID_BUY IS NULL
              , B.SESSION_ID
              , NULL) ) AS own_channels_motors_user_not_logg_contact

        -- items contactados
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'OWN CHANNELS'
              , lead_item_id
              , NULL) ) AS own_channels_motors_item_contacted

        -- sellers contactados
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'OWN CHANNELS'
              , B.cus_cust_id_sel
              , NULL) ) AS own_channels_motors_seller_contacted            
      ------------------------------------------------
      ---- MATT OTHER
      ------------------------------------------------
        -- contact timedecay
        , SAFE_DIVIDE( 
            SUM(IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'OTHER MATT'
            , MATT_PORC_TIMEDECAY
            , NULL) )
          , 100) AS matt_other_motors_timedecay_contact_attribution

        -- usuarios que contactaron
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'OTHER MATT'
              , COALESCE(CAST(A.CUS_CUST_ID_BUY AS STRING), B.SESSION_ID)
              , NULL) ) AS matt_other_motors_user_contact

        -- usuarios logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'OTHER MATT'
            AND A.CUS_CUST_ID_BUY IS NOT NULL
              , A.CUS_CUST_ID_BUY
              , NULL) ) AS matt_other_motors_user_logg_contact

        -- usuarios no logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'OTHER MATT'
            AND A.CUS_CUST_ID_BUY IS NULL
              , B.SESSION_ID
              , NULL) ) AS matt_other_motors_user_not_logg_contact

        -- items contactados
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'OTHER MATT'
              , lead_item_id
              , NULL) ) AS matt_other_motors_item_contacted

        -- sellers contactados
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'OTHER MATT'
              , B.cus_cust_id_sel
              , NULL) ) AS matt_other_motors_seller_contacted

      ------------------------------------------------
      ---- POM VIS desvio
      ------------------------------------------------
        -- contact timedecay
        , SAFE_DIVIDE( 
            SUM(IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'POM VIS'
            AND COALESCE(POM_GEN.matt_vertical, 'N/A') NOT IN UNNEST(var_matt_vertical)
            , MATT_PORC_TIMEDECAY
            , NULL) )
          , 100) AS pom_vis_desvio_motors_timedecay_contact_attribution

        -- usuarios que contactaron
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'POM VIS'
            AND COALESCE(POM_GEN.matt_vertical, 'N/A') NOT IN UNNEST(var_matt_vertical)
              , COALESCE(CAST(A.CUS_CUST_ID_BUY AS STRING), B.SESSION_ID)
              , NULL) ) AS pom_vis_desvio_motors_user_contact

        -- usuarios logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'POM VIS'
            AND COALESCE(POM_GEN.matt_vertical, 'N/A') NOT IN UNNEST(var_matt_vertical)
            AND A.CUS_CUST_ID_BUY IS NOT NULL
              , A.CUS_CUST_ID_BUY
              , NULL) ) AS pom_vis_desvio_motors_user_logg_contact

        -- usuarios no logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'POM VIS'
            AND COALESCE(POM_GEN.matt_vertical, 'N/A') NOT IN UNNEST(var_matt_vertical)
            AND A.CUS_CUST_ID_BUY IS NULL
              , B.SESSION_ID
              , NULL) ) AS pom_vis_desvio_motors_user_not_logg_contact

        -- items contactados
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'POM VIS'
            AND COALESCE(POM_GEN.matt_vertical, 'N/A') NOT IN UNNEST(var_matt_vertical)
              , lead_item_id
              , NULL) ) AS pom_vis_desvio_motors_item_contacted

        -- sellers contactados
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'POM VIS'
            AND COALESCE(POM_GEN.matt_vertical, 'N/A') NOT IN UNNEST(var_matt_vertical)
              , B.cus_cust_id_sel
              , NULL) ) AS pom_vis_desvio_motors_seller_contacted


      ------------------------------------------------
      ---- POM VIS GOOGLE SEARCH
      ------------------------------------------------
        -- contact timedecay
        , SAFE_DIVIDE( 
            SUM(IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('GOOGLE SEARCH')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            , MATT_PORC_TIMEDECAY
            , NULL) )
          , 100) AS pom_vis_google_search_motors_timedecay_contact_attribution

        -- usuarios que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('GOOGLE SEARCH')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
              , COALESCE(CAST(A.CUS_CUST_ID_BUY AS STRING), B.SESSION_ID)
              , NULL) ) AS pom_vis_google_search_motors_user_contact

        -- usuarios logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('GOOGLE SEARCH')
            AND A.CUS_CUST_ID_BUY IS NOT NULL
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
              , A.CUS_CUST_ID_BUY
              , NULL) ) AS pom_vis_google_search_motors_user_logg_contact

        -- usuarios no logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('GOOGLE SEARCH')
            AND A.CUS_CUST_ID_BUY IS NULL
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
              , B.SESSION_ID
              , NULL) ) AS pom_vis_google_search_motors_user_not_logg_contact

        -- items contactados
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('GOOGLE SEARCH')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
              , lead_item_id
              , NULL) ) AS pom_vis_google_search_motors_item_contacted

        -- sellers contactados
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('GOOGLE SEARCH')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
              , B.cus_cust_id_sel
              , NULL) ) AS pom_vis_google_search_motors_seller_contacted

      ------------------------------------------------
      ---- POM VIS GOOGLE DISPLAY
      ------------------------------------------------
        -- contact timedecay
        , SAFE_DIVIDE( 
            SUM(IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('GOOGLE DISPLAY')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            , MATT_PORC_TIMEDECAY
            , NULL) )
          , 100) AS pom_vis_google_display_motors_timedecay_contact_attribution

        -- usuarios que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('GOOGLE DISPLAY')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
              , COALESCE(CAST(A.CUS_CUST_ID_BUY AS STRING), B.SESSION_ID)
              , NULL) ) AS pom_vis_google_display_motors_user_contact

        -- usuarios logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('GOOGLE DISPLAY')
            AND A.CUS_CUST_ID_BUY IS NOT NULL
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
              , A.CUS_CUST_ID_BUY
              , NULL) ) AS pom_vis_google_display_motors_user_logg_contact

        -- usuarios no logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('GOOGLE DISPLAY')
            AND A.CUS_CUST_ID_BUY IS NULL
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
              , B.SESSION_ID
              , NULL) ) AS pom_vis_google_display_motors_user_not_logg_contact

        -- items contactados
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('GOOGLE DISPLAY')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
              , lead_item_id
              , NULL) ) AS pom_vis_google_display_motors_item_contacted

        -- sellers contactados
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('GOOGLE DISPLAY')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
              , B.cus_cust_id_sel
              , NULL) ) AS pom_vis_google_display_motors_seller_contacted
      ------------------------------------------------
      ---- POM VIS FACEBOOK
      ------------------------------------------------
        -- contact timedecay
        , SAFE_DIVIDE( 
            SUM(IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('FACEBOOK')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            , MATT_PORC_TIMEDECAY
            , NULL) )
          , 100) AS pom_vis_facebook_motors_timedecay_contact_attribution

        -- usuarios que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('FACEBOOK')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
              , COALESCE(CAST(A.CUS_CUST_ID_BUY AS STRING), B.SESSION_ID)
              , NULL) ) AS pom_vis_facebook_motors_user_contact

        -- usuarios logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('FACEBOOK')
            AND A.CUS_CUST_ID_BUY IS NOT NULL
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
              , A.CUS_CUST_ID_BUY
              , NULL) ) AS pom_vis_facebook_motors_user_logg_contact

        -- usuarios no logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('FACEBOOK')
            AND A.CUS_CUST_ID_BUY IS NULL
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
              , B.SESSION_ID
              , NULL) ) AS pom_vis_facebook_motors_user_not_logg_contact

        -- items contactados
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('FACEBOOK')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
              , lead_item_id
              , NULL) ) AS pom_vis_facebook_motors_item_contacted

        -- sellers contactados
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('FACEBOOK')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
              , B.cus_cust_id_sel
              , NULL) ) AS pom_vis_facebook_motors_seller_contacted

      ------------------------------------------------
      ---- POM VIS FACEBOOK FORMS
      ------------------------------------------------
        -- contact timedecay
        , SAFE_DIVIDE( 
            SUM(IF(
              (ITE_QUOT_SOURCE IN ('facebook') OR QUESTION_APP_ID IN (6606988212253970,6557539776310564) ) -- FB FORMS
          OR (is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('FACEBOOK FORMS') )
            , MATT_PORC_TIMEDECAY
            , NULL) )
          , 100) AS pom_vis_facebook_forms_motors_timedecay_contact_attribution

        -- usuarios que contactaron
        , COUNT(
            DISTINCT
              IF(
              (ITE_QUOT_SOURCE IN ('facebook') OR QUESTION_APP_ID IN (6606988212253970,6557539776310564) ) -- FB FORMS
          OR (is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('FACEBOOK FORMS') )
              , COALESCE(CAST(A.CUS_CUST_ID_BUY AS STRING), B.SESSION_ID)
              , NULL) ) AS pom_vis_facebook_forms_motors_user_contact

        -- usuarios logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
              (ITE_QUOT_SOURCE IN ('facebook') OR QUESTION_APP_ID IN (6606988212253970,6557539776310564) ) -- FB FORMS
          OR (is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('FACEBOOK FORMS') )
            AND A.CUS_CUST_ID_BUY IS NOT NULL
              , A.CUS_CUST_ID_BUY
              , NULL) ) AS pom_vis_facebook_forms_motors_user_logg_contact

        -- usuarios no logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
              (ITE_QUOT_SOURCE IN ('facebook') OR QUESTION_APP_ID IN (6606988212253970,6557539776310564) ) -- FB FORMS
          OR (is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('FACEBOOK FORMS') )
            AND A.CUS_CUST_ID_BUY IS NULL
              , B.SESSION_ID
              , NULL) ) AS pom_vis_facebook_forms_motors_user_not_logg_contact

        -- items contactados
        , COUNT(
            DISTINCT
              IF(
              (ITE_QUOT_SOURCE IN ('facebook') OR QUESTION_APP_ID IN (6606988212253970,6557539776310564) ) -- FB FORMS
          OR (is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('FACEBOOK FORMS') )
              , lead_item_id
              , NULL) ) AS pom_vis_facebook_forms_motors_item_contacted

        -- sellers contactados
        , COUNT(
            DISTINCT
              IF(
              (ITE_QUOT_SOURCE IN ('facebook') OR QUESTION_APP_ID IN (6606988212253970,6557539776310564) ) -- FB FORMS
          OR (is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('FACEBOOK FORMS') )
              , B.cus_cust_id_sel
              , NULL) ) AS pom_vis_facebook_forms_motors_seller_contacted

      ------------------------------------------------
      ---- POM VIS RTB
      ------------------------------------------------
        -- contact timedecay
        , SAFE_DIVIDE( 
            SUM(IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('RTB')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            , MATT_PORC_TIMEDECAY
            , NULL) )
          , 100) AS pom_vis_rtb_motors_timedecay_contact_attribution

        -- usuarios que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('RTB')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
              , COALESCE(CAST(A.CUS_CUST_ID_BUY AS STRING), B.SESSION_ID)
              , NULL) ) AS pom_vis_rtb_motors_user_contact

        -- usuarios logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('RTB')
            AND A.CUS_CUST_ID_BUY IS NOT NULL
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
              , A.CUS_CUST_ID_BUY
              , NULL) ) AS pom_vis_rtb_motors_user_logg_contact

        -- usuarios no logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('RTB')
            AND A.CUS_CUST_ID_BUY IS NULL
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
              , B.SESSION_ID
              , NULL) ) AS pom_vis_rtb_motors_user_not_logg_contact

        -- items contactados
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('RTB')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
              , lead_item_id
              , NULL) ) AS pom_vis_rtb_motors_item_contacted

        -- sellers contactados
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('RTB')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
              , B.cus_cust_id_sel
              , NULL) ) AS pom_vis_rtb_motors_seller_contacted


      ------------------------------------------------
      ---- POM VIS OTHER
      ------------------------------------------------
        -- contact timedecay
        , SAFE_DIVIDE( 
            SUM(IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('other')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            , MATT_PORC_TIMEDECAY
            , NULL) )
          , 100) AS pom_vis_other_motors_timedecay_contact_attribution

        -- usuarios que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('other')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
              , COALESCE(CAST(A.CUS_CUST_ID_BUY AS STRING), B.SESSION_ID)
              , NULL) ) AS pom_vis_other_motors_user_contact

        -- usuarios logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('other')
            AND A.CUS_CUST_ID_BUY IS NOT NULL
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
              , A.CUS_CUST_ID_BUY
              , NULL) ) AS pom_vis_other_motors_user_logg_contact

        -- usuarios no logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('other')
            AND A.CUS_CUST_ID_BUY IS NULL
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
              , B.SESSION_ID
              , NULL) ) AS pom_vis_other_motors_user_not_logg_contact

        -- items contactados
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('other')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
              , lead_item_id
              , NULL) ) AS pom_vis_other_motors_item_contacted

        -- sellers contactados
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('other')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
              , B.cus_cust_id_sel
              , NULL) ) AS pom_vis_other_motors_seller_contacted
      ------------------------------------------------
      ---- EXP: 01. contact user | A. con exclusion
      ------------------------------------------------
        -- contact timedecay
        , SAFE_DIVIDE( 
            SUM(IF(
              is_POM_VIS = 'POM VIS'  
          AND experimentos IN ('01. contact user | A. con exclusion')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            , MATT_PORC_TIMEDECAY
            , NULL) )
          , 100) AS pom_vis_xp_contact_user_con_exclusion_motors_timedecay_contact_attribution

        -- usuarios que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND experimentos IN ('01. contact user | A. con exclusion')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
              , COALESCE(CAST(A.CUS_CUST_ID_BUY AS STRING), B.SESSION_ID)
              , NULL) ) AS pom_vis_xp_contact_user_con_exclusion_motors_user_contact

        -- usuarios logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND experimentos IN ('01. contact user | A. con exclusion')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND A.CUS_CUST_ID_BUY IS NOT NULL
              , A.CUS_CUST_ID_BUY
              , NULL) ) AS pom_vis_xp_contact_user_con_exclusion_motors_user_logg_contact

        -- usuarios no logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND experimentos IN ('01. contact user | A. con exclusion')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND A.CUS_CUST_ID_BUY IS NULL
              , B.SESSION_ID
              , NULL) ) AS pom_vis_xp_contact_user_con_exclusion_motors_user_not_logg_contact

        -- items contactados
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND experimentos IN ('01. contact user | A. con exclusion')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
              , lead_item_id
              , NULL) ) AS pom_vis_xp_contact_user_con_exclusion_motors_item_contacted

        -- sellers contactados
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND experimentos IN ('01. contact user | A. con exclusion')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
              , B.cus_cust_id_sel
              , NULL) ) AS pom_vis_xp_contact_user_con_exclusion_motors_seller_contacted

      ------------------------------------------------
      ---- EXP: 01. contact user | B. sin exclusion
      ------------------------------------------------
        -- contact timedecay
        , SAFE_DIVIDE( 
            SUM(IF(
              is_POM_VIS = 'POM VIS'  
          AND experimentos IN ('01. contact user | B. sin exclusion')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            , MATT_PORC_TIMEDECAY
            , NULL) )
          , 100) AS pom_vis_xp_contact_user_sin_exclusion_motors_timedecay_contact_attribution

        -- usuarios que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND experimentos IN ('01. contact user | B. sin exclusion')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
              , COALESCE(CAST(A.CUS_CUST_ID_BUY AS STRING), B.SESSION_ID)
              , NULL) ) AS pom_vis_xp_contact_user_sin_exclusion_motors_user_contact

        -- usuarios logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND experimentos IN ('01. contact user | B. sin exclusion')
            AND A.CUS_CUST_ID_BUY IS NOT NULL
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
              , A.CUS_CUST_ID_BUY
              , NULL) ) AS pom_vis_xp_contact_user_sin_exclusion_motors_user_logg_contact

        -- usuarios no logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND experimentos IN ('01. contact user | B. sin exclusion')
            AND A.CUS_CUST_ID_BUY IS NULL
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
              , B.SESSION_ID
              , NULL) ) AS pom_vis_xp_contact_user_sin_exclusion_motors_user_not_logg_contact

        -- items contactados
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND experimentos IN ('01. contact user | B. sin exclusion')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
              , lead_item_id
              , NULL) ) AS pom_vis_xp_contact_user_sin_exclusion_motors_item_contacted

        -- sellers contactados
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND experimentos IN ('01. contact user | B. sin exclusion')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
              , B.cus_cust_id_sel
              , NULL) ) AS pom_vis_xp_contact_user_sin_exclusion_motors_seller_contacted
    ------------------------------------------------
    ---- Autos y camionetas
    ------------------------------------------------
      ------------------------------------------------
      ---- TOTAL (sin apertura de canal)
      ------------------------------------------------
        -- contact timedecay
        , COUNT(DISTINCT IF(E.CAT_CATEG_ID_L2 IN (1744)  , LEAD_ID, NULL) ) AS total_ayc_contact

        -- usuarios que contactaron
        , COUNT(
            DISTINCT
              IF(E.CAT_CATEG_ID_L2 IN (1744)
            , COALESCE(CAST(A.CUS_CUST_ID_BUY AS STRING), B.SESSION_ID)
            , NULL) 
              ) AS total_ayc_user_contact

        -- usuarios logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
                A.CUS_CUST_ID_BUY IS NOT NULL
              AND E.CAT_CATEG_ID_L2 IN (1744)
              , A.CUS_CUST_ID_BUY
              , NULL) ) AS total_ayc_user_logg_contact

        -- usuarios no logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
                A.CUS_CUST_ID_BUY IS NULL
              AND E.CAT_CATEG_ID_L2 IN (1744)
              , B.SESSION_ID
              , NULL) ) AS total_ayc_user_not_logg_contact

        -- items contactados
        , COUNT(
            DISTINCT
                IF(E.CAT_CATEG_ID_L2 IN (1744), lead_item_id, NULL)
             ) AS total_ayc_item_contacted

        -- sellers contactados
        , COUNT(
            DISTINCT
              IF(E.CAT_CATEG_ID_L2 IN (1744), B.cus_cust_id_sel, NULL)
              ) AS total_ayc_seller_contacted
      ------------------------------------------------
      ---- POM VIS
      ------------------------------------------------
        -- contact timedecay
        , SAFE_DIVIDE( 
            SUM(IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'POM VIS'
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
            , MATT_PORC_TIMEDECAY
            , NULL) )
          , 100) AS pom_vis_ayc_timedecay_contact_attribution

        -- usuarios que contactaron
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'POM VIS'
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , COALESCE(CAST(A.CUS_CUST_ID_BUY AS STRING), B.SESSION_ID)
              , NULL) ) AS pom_vis_ayc_user_contact

        -- usuarios logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'POM VIS'
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND A.CUS_CUST_ID_BUY IS NOT NULL
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , A.CUS_CUST_ID_BUY
              , NULL) ) AS pom_vis_ayc_user_logg_contact

        -- usuarios no logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'POM VIS'
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND A.CUS_CUST_ID_BUY IS NULL
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , B.SESSION_ID
              , NULL) ) AS pom_vis_ayc_user_not_logg_contact

        -- items contactados
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'POM VIS'
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , lead_item_id
              , NULL) ) AS pom_vis_ayc_item_contacted

        -- sellers contactados
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'POM VIS'
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , B.cus_cust_id_sel
              , NULL) ) AS pom_vis_ayc_seller_contacted

      ------------------------------------------------
      ---- DIRECT
      ------------------------------------------------
        -- contact timedecay
        , SAFE_DIVIDE( 
            SUM(IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'DIRECT'
            AND E.CAT_CATEG_ID_L2 IN (1744)
            , MATT_PORC_TIMEDECAY
            , NULL) )
          , 100) AS direct_ayc_timedecay_contact_attribution

        -- usuarios que contactaron
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'DIRECT'
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , COALESCE(CAST(A.CUS_CUST_ID_BUY AS STRING), B.SESSION_ID)
              , NULL) ) AS direct_ayc_user_contact

        -- usuarios logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'DIRECT'
            AND A.CUS_CUST_ID_BUY IS NOT NULL
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , A.CUS_CUST_ID_BUY
              , NULL) ) AS direct_ayc_user_logg_contact

        -- usuarios no logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'DIRECT'
            AND A.CUS_CUST_ID_BUY IS NULL
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , B.SESSION_ID
              , NULL) ) AS direct_ayc_user_not_logg_contact

        -- items contactados
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'DIRECT'
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , lead_item_id
              , NULL) ) AS direct_ayc_item_contacted

        -- sellers contactados
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'DIRECT'
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , B.cus_cust_id_sel
              , NULL) ) AS direct_ayc_seller_contacted

      ------------------------------------------------
      ---- SEO
      ------------------------------------------------
        -- contact timedecay
        , SAFE_DIVIDE( 
            SUM(IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'SEO'
          AND E.CAT_CATEG_ID_L2 IN (1744)
            , MATT_PORC_TIMEDECAY
            , NULL) )
          , 100) AS seo_ayc_timedecay_contact_attribution

        -- usuarios que contactaron
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'SEO'
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , COALESCE(CAST(A.CUS_CUST_ID_BUY AS STRING), B.SESSION_ID)
              , NULL) ) AS seo_ayc_user_contact

        -- usuarios logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'SEO'
            AND A.CUS_CUST_ID_BUY IS NOT NULL
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , A.CUS_CUST_ID_BUY
              , NULL) ) AS seo_ayc_user_logg_contact

        -- usuarios no logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'SEO'
            AND A.CUS_CUST_ID_BUY IS NULL
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , B.SESSION_ID
              , NULL) ) AS seo_ayc_user_not_logg_contact

        -- items contactados
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'SEO'
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , lead_item_id
              , NULL) ) AS seo_ayc_item_contacted

        -- sellers contactados
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'SEO'
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , B.cus_cust_id_sel
              , NULL) ) AS seo_ayc_seller_contacted
      ------------------------------------------------
      ---- OWN CHANNELS
      ------------------------------------------------
        -- contact timedecay
        , SAFE_DIVIDE( 
            SUM(IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'OWN CHANNELS'
          AND E.CAT_CATEG_ID_L2 IN (1744)
            , MATT_PORC_TIMEDECAY
            , NULL) )
          , 100) AS own_channels_ayc_timedecay_contact_attribution

        -- usuarios que contactaron
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'OWN CHANNELS'
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , COALESCE(CAST(A.CUS_CUST_ID_BUY AS STRING), B.SESSION_ID)
              , NULL) ) AS own_channels_ayc_user_contact

        -- usuarios logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'OWN CHANNELS'
            AND A.CUS_CUST_ID_BUY IS NOT NULL
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , A.CUS_CUST_ID_BUY
              , NULL) ) AS own_channels_ayc_user_logg_contact

        -- usuarios no logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'OWN CHANNELS'
            AND A.CUS_CUST_ID_BUY IS NULL
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , B.SESSION_ID
              , NULL) ) AS own_channels_ayc_user_not_logg_contact

        -- items contactados
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'OWN CHANNELS'
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , lead_item_id
              , NULL) ) AS own_channels_ayc_item_contacted

        -- sellers contactados
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'OWN CHANNELS'
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , B.cus_cust_id_sel
              , NULL) ) AS own_channels_ayc_seller_contacted            
      ------------------------------------------------
      ---- MATT OTHER
      ------------------------------------------------
        -- contact timedecay
        , SAFE_DIVIDE( 
            SUM(IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'OTHER MATT'
          AND E.CAT_CATEG_ID_L2 IN (1744)
            , MATT_PORC_TIMEDECAY
            , NULL) )
          , 100) AS matt_other_ayc_timedecay_contact_attribution

        -- usuarios que contactaron
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'OTHER MATT'
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , COALESCE(CAST(A.CUS_CUST_ID_BUY AS STRING), B.SESSION_ID)
              , NULL) ) AS matt_other_ayc_user_contact

        -- usuarios logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'OTHER MATT'
            AND A.CUS_CUST_ID_BUY IS NOT NULL
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , A.CUS_CUST_ID_BUY
              , NULL) ) AS matt_other_ayc_user_logg_contact

        -- usuarios no logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'OTHER MATT'
            AND A.CUS_CUST_ID_BUY IS NULL
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , B.SESSION_ID
              , NULL) ) AS matt_other_ayc_user_not_logg_contact

        -- items contactados
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'OTHER MATT'
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , lead_item_id
              , NULL) ) AS matt_other_ayc_item_contacted

        -- sellers contactados
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'OTHER MATT'
              , B.cus_cust_id_sel
              , NULL) ) AS matt_other_ayc_seller_contacted

      ------------------------------------------------
      ---- POM VIS desvio
      ------------------------------------------------
        -- contact timedecay
        , SAFE_DIVIDE( 
            SUM(IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'POM VIS'
            AND COALESCE(POM_GEN.matt_vertical, 'N/A') NOT IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
            , MATT_PORC_TIMEDECAY
            , NULL) )
          , 100) AS pom_vis_desvio_ayc_timedecay_contact_attribution

        -- usuarios que contactaron
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'POM VIS'
            AND COALESCE(POM_GEN.matt_vertical, 'N/A') NOT IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , COALESCE(CAST(A.CUS_CUST_ID_BUY AS STRING), B.SESSION_ID)
              , NULL) ) AS pom_vis_desvio_ayc_user_contact

        -- usuarios logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'POM VIS'
            AND COALESCE(POM_GEN.matt_vertical, 'N/A') NOT IN UNNEST(var_matt_vertical)
            AND A.CUS_CUST_ID_BUY IS NOT NULL
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , A.CUS_CUST_ID_BUY
              , NULL) ) AS pom_vis_desvio_ayc_user_logg_contact

        -- usuarios no logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'POM VIS'
            AND COALESCE(POM_GEN.matt_vertical, 'N/A') NOT IN UNNEST(var_matt_vertical)
            AND A.CUS_CUST_ID_BUY IS NULL
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , B.SESSION_ID
              , NULL) ) AS pom_vis_desvio_ayc_user_not_logg_contact

        -- items contactados
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'POM VIS'
            AND COALESCE(POM_GEN.matt_vertical, 'N/A') NOT IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , lead_item_id
              , NULL) ) AS pom_vis_desvio_ayc_item_contacted

        -- sellers contactados
        , COUNT(
            DISTINCT
              IF(
                  `meli-bi-data.SBOX_MKTVIS`.fx_grouped_attribution(C.ite_quot_source,B.mapp_app_id,H.matt_vertical,H.matt_campaign_type,H.matt_implementation_channel,A.matt_type_source,A.matt_stimulus_source_type,A.matt_strategy,A.matt_source,A.matt_channel,H.matt_tool) = 'POM VIS'
            AND COALESCE(POM_GEN.matt_vertical, 'N/A') NOT IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , B.cus_cust_id_sel
              , NULL) ) AS pom_vis_desvio_ayc_seller_contacted


      ------------------------------------------------
      ---- POM VIS GOOGLE SEARCH
      ------------------------------------------------
        -- contact timedecay
        , SAFE_DIVIDE( 
            SUM(IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('GOOGLE SEARCH')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
            , MATT_PORC_TIMEDECAY
            , NULL) )
          , 100) AS pom_vis_google_search_ayc_timedecay_contact_attribution

        -- usuarios que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('GOOGLE SEARCH')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , COALESCE(CAST(A.CUS_CUST_ID_BUY AS STRING), B.SESSION_ID)
              , NULL) ) AS pom_vis_google_search_ayc_user_contact

        -- usuarios logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('GOOGLE SEARCH')
            AND A.CUS_CUST_ID_BUY IS NOT NULL
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , A.CUS_CUST_ID_BUY
              , NULL) ) AS pom_vis_google_search_ayc_user_logg_contact

        -- usuarios no logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('GOOGLE SEARCH')
            AND A.CUS_CUST_ID_BUY IS NULL
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , B.SESSION_ID
              , NULL) ) AS pom_vis_google_search_ayc_user_not_logg_contact

        -- items contactados
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('GOOGLE SEARCH')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , lead_item_id
              , NULL) ) AS pom_vis_google_search_ayc_item_contacted

        -- sellers contactados
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('GOOGLE SEARCH')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , B.cus_cust_id_sel
              , NULL) ) AS pom_vis_google_search_ayc_seller_contacted

      ------------------------------------------------
      ---- POM VIS GOOGLE DISPLAY
      ------------------------------------------------
        -- contact timedecay
        , SAFE_DIVIDE( 
            SUM(IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('GOOGLE DISPLAY')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
            , MATT_PORC_TIMEDECAY
            , NULL) )
          , 100) AS pom_vis_google_display_ayc_timedecay_contact_attribution

        -- usuarios que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('GOOGLE DISPLAY')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , COALESCE(CAST(A.CUS_CUST_ID_BUY AS STRING), B.SESSION_ID)
              , NULL) ) AS pom_vis_google_display_ayc_user_contact

        -- usuarios logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('GOOGLE DISPLAY')
            AND A.CUS_CUST_ID_BUY IS NOT NULL
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , A.CUS_CUST_ID_BUY
              , NULL) ) AS pom_vis_google_display_ayc_user_logg_contact

        -- usuarios no logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('GOOGLE DISPLAY')
            AND A.CUS_CUST_ID_BUY IS NULL
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , B.SESSION_ID
              , NULL) ) AS pom_vis_google_display_ayc_user_not_logg_contact

        -- items contactados
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('GOOGLE DISPLAY')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , lead_item_id
              , NULL) ) AS pom_vis_google_display_ayc_item_contacted

        -- sellers contactados
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('GOOGLE DISPLAY')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , B.cus_cust_id_sel
              , NULL) ) AS pom_vis_google_display_ayc_seller_contacted
      ------------------------------------------------
      ---- POM VIS FACEBOOK
      ------------------------------------------------
        -- contact timedecay
        , SAFE_DIVIDE( 
            SUM(IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('FACEBOOK')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
            , MATT_PORC_TIMEDECAY
            , NULL) )
          , 100) AS pom_vis_facebook_ayc_timedecay_contact_attribution

        -- usuarios que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('FACEBOOK')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , COALESCE(CAST(A.CUS_CUST_ID_BUY AS STRING), B.SESSION_ID)
              , NULL) ) AS pom_vis_facebook_ayc_user_contact

        -- usuarios logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('FACEBOOK')
            AND A.CUS_CUST_ID_BUY IS NOT NULL
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , A.CUS_CUST_ID_BUY
              , NULL) ) AS pom_vis_facebook_ayc_user_logg_contact

        -- usuarios no logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('FACEBOOK')
            AND A.CUS_CUST_ID_BUY IS NULL
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , B.SESSION_ID
              , NULL) ) AS pom_vis_facebook_ayc_user_not_logg_contact

        -- items contactados
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('FACEBOOK')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , lead_item_id
              , NULL) ) AS pom_vis_facebook_ayc_item_contacted

        -- sellers contactados
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('FACEBOOK')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , B.cus_cust_id_sel
              , NULL) ) AS pom_vis_facebook_ayc_seller_contacted

      ------------------------------------------------
      ---- POM VIS FACEBOOK FORMS
      ------------------------------------------------
        -- contact timedecay
        , SAFE_DIVIDE( 
            SUM(IF(
              (ITE_QUOT_SOURCE IN ('facebook') OR QUESTION_APP_ID IN (6606988212253970,6557539776310564) ) -- FB FORMS
          OR (is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('FACEBOOK FORMS') )
            AND E.CAT_CATEG_ID_L2 IN (1744)
            , MATT_PORC_TIMEDECAY
            , NULL) )
          , 100) AS pom_vis_facebook_forms_ayc_timedecay_contact_attribution

        -- usuarios que contactaron
        , COUNT(
            DISTINCT
              IF(
              (ITE_QUOT_SOURCE IN ('facebook') OR QUESTION_APP_ID IN (6606988212253970,6557539776310564) ) -- FB FORMS
          OR (is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('FACEBOOK FORMS') )
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , COALESCE(CAST(A.CUS_CUST_ID_BUY AS STRING), B.SESSION_ID)
              , NULL) ) AS pom_vis_facebook_forms_ayc_user_contact

        -- usuarios logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
              (ITE_QUOT_SOURCE IN ('facebook') OR QUESTION_APP_ID IN (6606988212253970,6557539776310564) ) -- FB FORMS
          OR (is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('FACEBOOK FORMS') )
            AND A.CUS_CUST_ID_BUY IS NOT NULL
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , A.CUS_CUST_ID_BUY
              , NULL) ) AS pom_vis_facebook_forms_ayc_user_logg_contact

        -- usuarios no logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
              (ITE_QUOT_SOURCE IN ('facebook') OR QUESTION_APP_ID IN (6606988212253970,6557539776310564) ) -- FB FORMS
          OR (is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('FACEBOOK FORMS') )
            AND A.CUS_CUST_ID_BUY IS NULL
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , B.SESSION_ID
              , NULL) ) AS pom_vis_facebook_forms_ayc_user_not_logg_contact

        -- items contactados
        , COUNT(
            DISTINCT
              IF(
              (ITE_QUOT_SOURCE IN ('facebook') OR QUESTION_APP_ID IN (6606988212253970,6557539776310564) ) -- FB FORMS
          OR (is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('FACEBOOK FORMS') )
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , lead_item_id
              , NULL) ) AS pom_vis_facebook_forms_ayc_item_contacted

        -- sellers contactados
        , COUNT(
            DISTINCT
              IF(
              (ITE_QUOT_SOURCE IN ('facebook') OR QUESTION_APP_ID IN (6606988212253970,6557539776310564) ) -- FB FORMS
          OR (is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('FACEBOOK FORMS') )
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , B.cus_cust_id_sel
              , NULL) ) AS pom_vis_facebook_forms_ayc_seller_contacted

      ------------------------------------------------
      ---- POM VIS RTB
      ------------------------------------------------
        -- contact timedecay
        , SAFE_DIVIDE( 
            SUM(IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('RTB')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
            , MATT_PORC_TIMEDECAY
            , NULL) )
          , 100) AS pom_vis_rtb_ayc_timedecay_contact_attribution

        -- usuarios que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('RTB')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , COALESCE(CAST(A.CUS_CUST_ID_BUY AS STRING), B.SESSION_ID)
              , NULL) ) AS pom_vis_rtb_ayc_user_contact

        -- usuarios logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('RTB')
            AND A.CUS_CUST_ID_BUY IS NOT NULL
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , A.CUS_CUST_ID_BUY
              , NULL) ) AS pom_vis_rtb_ayc_user_logg_contact

        -- usuarios no logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('RTB')
            AND A.CUS_CUST_ID_BUY IS NULL
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , B.SESSION_ID
              , NULL) ) AS pom_vis_rtb_ayc_user_not_logg_contact

        -- items contactados
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('RTB')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , lead_item_id
              , NULL) ) AS pom_vis_rtb_ayc_item_contacted

        -- sellers contactados
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('RTB')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , B.cus_cust_id_sel
              , NULL) ) AS pom_vis_rtb_ayc_seller_contacted


      ------------------------------------------------
      ---- POM VIS OTHER
      ------------------------------------------------
        -- contact timedecay
        , SAFE_DIVIDE( 
            SUM(IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('other')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
            , MATT_PORC_TIMEDECAY
            , NULL) )
          , 100) AS pom_vis_other_ayc_timedecay_contact_attribution

        -- usuarios que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('other')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , COALESCE(CAST(A.CUS_CUST_ID_BUY AS STRING), B.SESSION_ID)
              , NULL) ) AS pom_vis_other_ayc_user_contact

        -- usuarios logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('other')
            AND A.CUS_CUST_ID_BUY IS NOT NULL
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , A.CUS_CUST_ID_BUY
              , NULL) ) AS pom_vis_other_ayc_user_logg_contact

        -- usuarios no logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('other')
            AND A.CUS_CUST_ID_BUY IS NULL
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , B.SESSION_ID
              , NULL) ) AS pom_vis_other_ayc_user_not_logg_contact

        -- items contactados
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('other')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , lead_item_id
              , NULL) ) AS pom_vis_other_ayc_item_contacted

        -- sellers contactados
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND POM_VIS_subgroup IN ('other')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , B.cus_cust_id_sel
              , NULL) ) AS pom_vis_other_ayc_seller_contacted

      ------------------------------------------------
      ---- EXP: 01. contact user | A. con exclusion
      ------------------------------------------------
        -- contact timedecay
        , SAFE_DIVIDE( 
            SUM(IF(
              is_POM_VIS = 'POM VIS'  
          AND experimentos IN ('01. contact user | A. con exclusion')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
            , MATT_PORC_TIMEDECAY
            , NULL) )
          , 100) AS pom_vis_xp_contact_user_con_exclusion_ayc_timedecay_contact_attribution

        -- usuarios que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND experimentos IN ('01. contact user | A. con exclusion')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , COALESCE(CAST(A.CUS_CUST_ID_BUY AS STRING), B.SESSION_ID)
              , NULL) ) AS pom_vis_xp_contact_user_con_exclusion_ayc_user_contact

        -- usuarios logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND experimentos IN ('01. contact user | A. con exclusion')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND A.CUS_CUST_ID_BUY IS NOT NULL
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , A.CUS_CUST_ID_BUY
              , NULL) ) AS pom_vis_xp_contact_user_con_exclusion_ayc_user_logg_contact

        -- usuarios no logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND experimentos IN ('01. contact user | A. con exclusion')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND A.CUS_CUST_ID_BUY IS NULL
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , B.SESSION_ID
              , NULL) ) AS pom_vis_xp_contact_user_con_exclusion_ayc_user_not_logg_contact

        -- items contactados
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND experimentos IN ('01. contact user | A. con exclusion')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , lead_item_id
              , NULL) ) AS pom_vis_xp_contact_user_con_exclusion_ayc_item_contacted

        -- sellers contactados
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND experimentos IN ('01. contact user | A. con exclusion')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , B.cus_cust_id_sel
              , NULL) ) AS pom_vis_xp_contact_user_con_exclusion_ayc_seller_contacted

      ------------------------------------------------
      ---- EXP: 01. contact user | B. sin exclusion
      ------------------------------------------------
        -- contact timedecay
        , SAFE_DIVIDE( 
            SUM(IF(
              is_POM_VIS = 'POM VIS'  
          AND experimentos IN ('01. contact user | B. sin exclusion')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
            , MATT_PORC_TIMEDECAY
            , NULL) )
          , 100) AS pom_vis_xp_contact_user_sin_exclusion_ayc_timedecay_contact_attribution

        -- usuarios que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND experimentos IN ('01. contact user | B. sin exclusion')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , COALESCE(CAST(A.CUS_CUST_ID_BUY AS STRING), B.SESSION_ID)
              , NULL) ) AS pom_vis_xp_contact_user_sin_exclusion_ayc_user_contact

        -- usuarios logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND experimentos IN ('01. contact user | B. sin exclusion')
            AND A.CUS_CUST_ID_BUY IS NOT NULL
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , A.CUS_CUST_ID_BUY
              , NULL) ) AS pom_vis_xp_contact_user_sin_exclusion_ayc_user_logg_contact

        -- usuarios no logueados que contactaron
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND experimentos IN ('01. contact user | B. sin exclusion')
            AND A.CUS_CUST_ID_BUY IS NULL
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , B.SESSION_ID
              , NULL) ) AS pom_vis_xp_contact_user_sin_exclusion_ayc_user_not_logg_contact

        -- items contactados
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND experimentos IN ('01. contact user | B. sin exclusion')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , lead_item_id
              , NULL) ) AS pom_vis_xp_contact_user_sin_exclusion_ayc_item_contacted

        -- sellers contactados
        , COUNT(
            DISTINCT
              IF(
              is_POM_VIS = 'POM VIS'  
          AND experimentos IN ('01. contact user | B. sin exclusion')
            AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)
            AND E.CAT_CATEG_ID_L2 IN (1744)
              , B.cus_cust_id_sel
              , NULL) ) AS pom_vis_xp_contact_user_sin_exclusion_ayc_seller_contacted

            
  FROM `growth-attribution.production.BT_MATT_ATTRIBUTION_LEADS` AS A

  -- traigo tools asociadas a VIS
  LEFT JOIN generic_pom_vis AS POM_GEN
  ON A.PMS_TOOL_ID = POM_GEN.matt_tool

  -- para joinear con fuente de d√≥nde MATT toma leads de questions, call, whatsapp y quotation
  LEFT JOIN `meli-bi-data.WHOWNER.BT_CONTACTS_CLASSIFIEDS` AS B
  ON A.lead_id = B.id

  -- para tener info extra de quotations. FB FORMS = ITE_QUOT_SOURCE IN ('facebook')
  LEFT JOIN `meli-bi-data.WHOWNER.BT_ITE_QUOTATION` AS C
  ON CAST(B.EXTERNAL_ENTITY_ID AS STRING) = CAST(C.ITE_QUOTATION_ID AS STRING)

  -- para tener info extra de questions. FB FORMS = QUESTION_APP_ID IN (6606988212253970,6557539776310564)
  LEFT JOIN `meli-bi-data.WHOWNER.BT_ITEM_QUESTIONS` AS D
  ON CAST(B.EXTERNAL_ENTITY_ID AS STRING) = CAST(D.QUES_ID AS STRING)

  -- para tener arbol de categorias
  LEFT JOIN `meli-bi-data.WHOWNER.AG_LK_CAT_CATEGORIES` AS E
  ON E.CAT_CATEG_ID_L7 = CAST(B.CAT_CATEG_ID_L7 AS INTEGER)
  AND E.SIT_SITE_ID = B.SIT_SITE_ID

  -- -- para joinear con atributos de anuncio real estate
  -- LEFT JOIN `meli-bi-data.SBOX_CLASSI_PLANNING.LK_ATRIBUTOS_IMRE` AS F
  -- ON CAST(A.lead_item_id AS STRING) = CAST(F.ite_item_id AS STRING)
  -- AND A.sit_site_id = F.sit_site_id


  -- para joinear con atributos de anuncio motors
  LEFT JOIN `meli-bi-data.SBOX_CLASSI_PLANNING.LK_ATRIBUTOS_IMM_IMS` AS G
  ON CAST(A.lead_item_id AS STRING) = CAST(G.ite_item_id AS STRING)
  AND A.sit_site_id = G.sit_site_id

  -- para joinear con datos de cada tool id existente en el matt admin
  LEFT JOIN `meli-bi-data.WHOWNER.BT_MATT_METADATA` AS H
  ON A.pms_tool_id = H.matt_tool
  AND H.matt_business_unit = 'VIS' -- solo tool ids de VIS
  AND H.tim_day = CURRENT_DATE -- para traer el listado actualizado sin duplicar informacion

  WHERE A.LEAD_CREATED_DT BETWEEN fecha_desde AND fecha_hasta
  AND LEAD_ATTRIBUTION_TYPE = 'VIS' -- para tener metricas relacionadas a VIS (en la tabla convive otra BU)
  AND LEAD_TYPE IN ('Quotation','Question','Click to Whatsapp','Click to Call') -- por el momento truncar en estos leads porque los de simulacion de cr√©dito necesitan un cambio que todav√≠a est√° pending por parte de MATT IT
  AND B.cat_categ_id_l1 = parametro_vertical
  AND A.sit_site_id IN UNNEST(var_sites)

  GROUP BY 1,2,3

)

, cost AS
(
  SELECT
      DATE_TRUNC(A.tim_day, DAY) AS period -- DATE_TRUNC(A.tim_day, MONTH) DATE_TRUNC(A.tim_day, ISOWEEK) 
    , is_POM_VIS
    , POM_VIS_subgroup
    , experimentos
    , A.sit_site_id
    , CLICKS
    , IMPRESSIONS
    , COST_USD
    , COST_LC



  FROM `meli-bi-data.SBOX_MARKETING.BT_COST_GOOGLE_DAILY` AS A

  -- traigo tools asociadas a VIS
  INNER JOIN generic_pom_vis AS POM_GEN
  ON A.tool_id = POM_GEN.matt_tool


  WHERE A.tim_day BETWEEN fecha_desde AND fecha_hasta
  AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)


  UNION ALL
  SELECT
      DATE_TRUNC(A.tim_day, DAY) AS period -- DATE_TRUNC(A.tim_day, MONTH) DATE_TRUNC(A.tim_day, ISOWEEK) 
    , is_POM_VIS
    , POM_VIS_subgroup
    , experimentos
    , A.sit_site_id
    , CLICKS
    , IMPRESSIONS
    , COST_USD
    , COST_LC

  FROM `meli-bi-data.SBOX_MARKETING.BT_COST_FACEBOOK_DAILY` AS A

  -- traigo tools asociadas a VIS
  INNER JOIN generic_pom_vis AS POM_GEN
  ON A.tool_id = POM_GEN.matt_tool


  WHERE A.tim_day BETWEEN fecha_desde AND fecha_hasta
  AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)

  UNION ALL
  SELECT
      DATE_TRUNC(event_date, DAY) AS period -- DATE_TRUNC(event_date, MONTH) DATE_TRUNC(event_date, ISOWEEK) 
    , is_POM_VIS
    , POM_VIS_subgroup
    , experimentos
    , A.sit_site_id
    , CLICKS
    , IMPRESSIONS
    , COST_USD
    , COST_LC


  FROM `meli-bi-data.SBOX_MARKETING.BT_COST_RTB_DAILY` AS A

  -- traigo tools asociadas a VIS
  INNER JOIN generic_pom_vis AS POM_GEN
  ON A.tool_id = POM_GEN.matt_tool

  WHERE A.event_date BETWEEN fecha_desde AND fecha_hasta
  AND POM_GEN.matt_vertical IN UNNEST(var_matt_vertical)

)

, cost_agrupado AS
(
  SELECT
      sit_site_id
    , period

      ------------------------------------------------
      ---- POM VIS
      ------------------------------------------------
        , SUM(
          IF(
            is_POM_VIS = 'POM VIS'  
          , CLICKS
          , NULL) ) AS pom_vis_clicks

        , SUM(
          IF(
            is_POM_VIS = 'POM VIS'  
          , IMPRESSIONS
          , NULL) ) AS pom_vis_impressions

        , SUM(
          IF(
            is_POM_VIS = 'POM VIS'  
          , COST_USD
          , NULL) ) AS pom_vis_usd_cost

        , SUM(
          IF(
            is_POM_VIS = 'POM VIS'  
          , COST_LC
          , NULL) ) AS pom_vis_lc_cost


      ------------------------------------------------
      ---- POM VIS GOOGLE SEARCH
      ------------------------------------------------
        , SUM(
          IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('GOOGLE SEARCH')
          , CLICKS
          , NULL) ) AS pom_vis_google_search_clicks

        , SUM(
          IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('GOOGLE SEARCH')
          , IMPRESSIONS
          , NULL) ) AS pom_vis_google_search_impressions

        , SUM(
          IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('GOOGLE SEARCH')
          , COST_USD
          , NULL) ) AS pom_vis_google_search_usd_cost

        , SUM(
          IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('GOOGLE SEARCH')
          , COST_LC
          , NULL) ) AS pom_vis_google_search_lc_cost

      ------------------------------------------------
      ---- POM VIS GOOGLE DISPLAY
      ------------------------------------------------
        , SUM(
          IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('GOOGLE DISPLAY')
          , CLICKS
          , NULL) ) AS pom_vis_google_display_clicks

        , SUM(
          IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('GOOGLE DISPLAY')
          , IMPRESSIONS
          , NULL) ) AS pom_vis_google_display_impressions

        , SUM(
          IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('GOOGLE DISPLAY')
          , COST_USD
          , NULL) ) AS pom_vis_google_display_usd_cost

        , SUM(
          IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('GOOGLE DISPLAY')
          , COST_LC
          , NULL) ) AS pom_vis_google_display_lc_cost


      ------------------------------------------------
      ---- POM VIS FACEBOOK
      ------------------------------------------------
        , SUM(
          IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('FACEBOOK')
          , CLICKS
          , NULL) ) AS pom_vis_facebook_clicks

        , SUM(
          IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('FACEBOOK')
          , IMPRESSIONS
          , NULL) ) AS pom_vis_facebook_impressions

        , SUM(
          IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('FACEBOOK')
          , COST_USD
          , NULL) ) AS pom_vis_facebook_usd_cost

        , SUM(
          IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('FACEBOOK')
          , COST_LC
          , NULL) ) AS pom_vis_facebook_lc_cost

      ------------------------------------------------
      ---- POM VIS FACEBOOK FORMS
      ------------------------------------------------
        , SUM(
          IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('FACEBOOK FORMS')
          , CLICKS
          , NULL) ) AS pom_vis_facebook_forms_clicks

        , SUM(
          IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('FACEBOOK FORMS')
          , IMPRESSIONS
          , NULL) ) AS pom_vis_facebook_forms_impressions

        , SUM(
          IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('FACEBOOK FORMS')
          , COST_USD
          , NULL) ) AS pom_vis_facebook_forms_usd_cost

        , SUM(
          IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('FACEBOOK FORMS')
          , COST_LC
          , NULL) ) AS pom_vis_facebook_forms_lc_cost

      ------------------------------------------------
      ---- POM VIS RTB
      ------------------------------------------------
        , SUM(
          IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('RTB')
          , CLICKS
          , NULL) ) AS pom_vis_rtb_clicks

        , SUM(
          IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('RTB')
          , IMPRESSIONS
          , NULL) ) AS pom_vis_rtb_impressions

        , SUM(
          IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('RTB')
          , COST_USD
          , NULL) ) AS pom_vis_rtb_usd_cost

        , SUM(
          IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('RTB')
          , COST_LC
          , NULL) ) AS pom_vis_rtb_lc_cost

      ------------------------------------------------
      ---- POM VIS OTHER
      ------------------------------------------------
        , SUM(
          IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('other')
          , CLICKS
          , NULL) ) AS pom_vis_other_clicks

        , SUM(
          IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('other')
          , IMPRESSIONS
          , NULL) ) AS pom_vis_other_impressions

        , SUM(
          IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('other')
          , COST_USD
          , NULL) ) AS pom_vis_other_usd_cost

        , SUM(
          IF(
                is_POM_VIS = 'POM VIS'  
            AND POM_VIS_subgroup IN ('other')
          , COST_LC
          , NULL) ) AS pom_vis_other_lc_cost

      ------------------------------------------------
      ---- EXP: 01. contact user | A. con exclusion
      ------------------------------------------------
        , SUM(
          IF(
                is_POM_VIS = 'POM VIS'  
            AND experimentos IN ('01. contact user | A. con exclusion')
          , CLICKS
          , NULL) ) AS pom_vis_xp_contact_user_con_exclusion_clicks

        , SUM(
          IF(
                is_POM_VIS = 'POM VIS'  
            AND experimentos IN ('01. contact user | A. con exclusion')
          , IMPRESSIONS
          , NULL) ) AS pom_vis_xp_contact_user_con_exclusion_impressions

        , SUM(
          IF(
                is_POM_VIS = 'POM VIS'  
            AND experimentos IN ('01. contact user | A. con exclusion')
          , COST_USD
          , NULL) ) AS pom_vis_xp_contact_user_con_exclusion_usd_cost

        , SUM(
          IF(
                is_POM_VIS = 'POM VIS'  
            AND experimentos IN ('01. contact user | A. con exclusion')
          , COST_LC
          , NULL) ) AS pom_vis_xp_contact_user_con_exclusion_lc_cost

      ------------------------------------------------
      ---- EXP: 01. contact user | B. sin exclusion
      ------------------------------------------------
        , SUM(
          IF(
                is_POM_VIS = 'POM VIS'  
            AND experimentos IN ('01. contact user | B. sin exclusion')
          , CLICKS
          , NULL) ) AS pom_vis_xp_contact_user_sin_exclusion_clicks

        , SUM(
          IF(
                is_POM_VIS = 'POM VIS'  
            AND experimentos IN ('01. contact user | B. sin exclusion')
          , IMPRESSIONS
          , NULL) ) AS pom_vis_xp_contact_user_sin_exclusion_impressions

        , SUM(
          IF(
                is_POM_VIS = 'POM VIS'  
            AND experimentos IN ('01. contact user | B. sin exclusion')
          , COST_USD
          , NULL) ) AS pom_vis_xp_contact_user_sin_exclusion_usd_cost

        , SUM(
          IF(
                is_POM_VIS = 'POM VIS'  
            AND experimentos IN ('01. contact user | B. sin exclusion')
          , COST_LC
          , NULL) ) AS pom_vis_xp_contact_user_sin_exclusion_lc_cost

  FROM cost

  GROUP BY 1,2

)

SELECT -- A.*, B.* EXCEPT(sit_site_id, period), C.* EXCEPT(sit_site_id, period)
    A.vertical
  , A.sit_site_id
  , A.period

    ------------------------
    -- TOTAL (sin apertura de canal)
    ------------------------
      -- leads
      , total_motors_contact
      , SAFE_DIVIDE(pom_vis_motors_timedecay_contact_attribution, total_motors_contact) AS perc_pom_vis_motors_timedecay_contact_attribution
      , SAFE_DIVIDE(direct_motors_timedecay_contact_attribution, total_motors_contact) AS perc_direct_motors_timedecay_contact_attribution
      , SAFE_DIVIDE(seo_motors_timedecay_contact_attribution, total_motors_contact) AS perc_seo_motors_timedecay_contact_attribution
      , SAFE_DIVIDE(own_channels_motors_timedecay_contact_attribution, total_motors_contact) AS perc_own_channels_motors_timedecay_contact_attribution
      , SAFE_DIVIDE(matt_other_motors_timedecay_contact_attribution, total_motors_contact) AS perc_matt_other_motors_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_desvio_motors_timedecay_contact_attribution, total_motors_contact) AS perc_pom_vis_desvio_motors_timedecay_contact_attribution

      , total_motors_user_contact
      , SAFE_DIVIDE(pom_vis_motors_user_contact ,(COALESCE(pom_vis_motors_user_contact, 0) + COALESCE(direct_motors_user_contact, 0) + COALESCE(seo_motors_user_contact, 0) + COALESCE(own_channels_motors_user_contact, 0) + COALESCE(matt_other_motors_user_contact, 0) + COALESCE(pom_vis_desvio_motors_user_contact, 0) ) ) perc_pom_vis_motors_user_contact

      , SAFE_DIVIDE(direct_motors_user_contact ,(COALESCE(pom_vis_motors_user_contact, 0) + COALESCE(direct_motors_user_contact, 0) + COALESCE(seo_motors_user_contact, 0) + COALESCE(own_channels_motors_user_contact, 0) + COALESCE(matt_other_motors_user_contact, 0) + COALESCE(pom_vis_desvio_motors_user_contact, 0) ) ) perc_direct_motors_user_contact

      , SAFE_DIVIDE(seo_motors_user_contact ,(COALESCE(pom_vis_motors_user_contact, 0) + COALESCE(direct_motors_user_contact, 0) + COALESCE(seo_motors_user_contact, 0) + COALESCE(own_channels_motors_user_contact, 0) + COALESCE(matt_other_motors_user_contact, 0) + COALESCE(pom_vis_desvio_motors_user_contact, 0) ) ) perc_seo_motors_user_contact

      , SAFE_DIVIDE(own_channels_motors_user_contact ,(COALESCE(pom_vis_motors_user_contact, 0) + COALESCE(direct_motors_user_contact, 0) + COALESCE(seo_motors_user_contact, 0) + COALESCE(own_channels_motors_user_contact, 0) + COALESCE(matt_other_motors_user_contact, 0) + COALESCE(pom_vis_desvio_motors_user_contact, 0) ) ) perc_own_channels_motors_user_contact

      , SAFE_DIVIDE(matt_other_motors_user_contact ,(COALESCE(pom_vis_motors_user_contact, 0) + COALESCE(direct_motors_user_contact, 0) + COALESCE(seo_motors_user_contact, 0) + COALESCE(own_channels_motors_user_contact, 0) + COALESCE(matt_other_motors_user_contact, 0) + COALESCE(pom_vis_desvio_motors_user_contact, 0) ) ) perc_matt_other_motors_user_contact

      , SAFE_DIVIDE(pom_vis_desvio_motors_user_contact ,(COALESCE(pom_vis_motors_user_contact, 0) + COALESCE(direct_motors_user_contact, 0) + COALESCE(seo_motors_user_contact, 0) + COALESCE(own_channels_motors_user_contact, 0) + COALESCE(matt_other_motors_user_contact, 0) + COALESCE(pom_vis_desvio_motors_user_contact, 0) ) ) perc_pom_vis_desvio_motors_user_contact



      , SAFE_DIVIDE(total_motors_contact, total_motors_user_contact) AS avg_motors_contact_per_user
      , total_motors_user_logg_contact
      , total_motors_user_not_logg_contact
      , SAFE_DIVIDE(total_motors_user_logg_contact, ( COALESCE(total_motors_user_logg_contact, 0) + COALESCE(total_motors_user_not_logg_contact, 0) ) ) AS perc_total_motors_user_logg_contact
      , SAFE_DIVIDE(total_motors_user_not_logg_contact, ( COALESCE(total_motors_user_logg_contact, 0) + COALESCE(total_motors_user_not_logg_contact, 0) ) ) AS perc_total_motors_user_not_logg_contact
      , total_motors_item_contacted
      , SAFE_DIVIDE(total_motors_contact, total_motors_item_contacted) AS avg_total_motors_item_contacted
      , total_motors_seller_contacted
      , SAFE_DIVIDE(total_motors_contact, total_motors_seller_contacted) AS avg_total_motors_seller_contacted


   ------------------------
    -- POM VIS TOTAL
    ------------------------
      -- leads
      , pom_vis_motors_timedecay_contact_attribution
      , pom_vis_motors_user_contact
      , SAFE_DIVIDE(pom_vis_motors_timedecay_contact_attribution, pom_vis_motors_user_contact) AS avg_pom_vis_motors_contact_per_user
      , pom_vis_motors_user_logg_contact
      , pom_vis_motors_user_not_logg_contact
      , SAFE_DIVIDE(pom_vis_motors_user_logg_contact, ( COALESCE(pom_vis_motors_user_logg_contact, 0) + COALESCE(pom_vis_motors_user_not_logg_contact,0) ) ) AS perc_pom_vis_motors_user_logg_contact
      , SAFE_DIVIDE(pom_vis_motors_user_not_logg_contact, ( COALESCE(pom_vis_motors_user_logg_contact, 0) + COALESCE(pom_vis_motors_user_not_logg_contact,0) ) ) AS perc_pom_vis_motors_user_not_logg_contact
      , pom_vis_motors_item_contacted
      , SAFE_DIVIDE(pom_vis_motors_timedecay_contact_attribution, pom_vis_motors_item_contacted) AS avg_pom_vis_motors_item_contacted
      , pom_vis_motors_seller_contacted
      , SAFE_DIVIDE(pom_vis_motors_timedecay_contact_attribution, pom_vis_motors_seller_contacted) AS avg_pom_vis_motors_seller_contacted

      -- touchpoints
      , pom_vis_user_touch_point
      , pom_vis_user_logg_touch_point
      , pom_vis_user_not_logg_touch_point
      , SAFE_DIVIDE(pom_vis_user_logg_touch_point, ( COALESCE(pom_vis_user_logg_touch_point, 0) + COALESCE(pom_vis_user_not_logg_touch_point, 0) ) ) AS perc_pom_vis_user_logg_touch_point
      , SAFE_DIVIDE(pom_vis_user_not_logg_touch_point, ( COALESCE(pom_vis_user_logg_touch_point, 0) + COALESCE(pom_vis_user_not_logg_touch_point, 0) ) ) AS perc_pom_vis_user_not_logg_touch_point

      -- cost clicks impressions
      , pom_vis_clicks
      , pom_vis_impressions
      , pom_vis_usd_cost
      , pom_vis_lc_cost
      , SAFE_DIVIDE(pom_vis_lc_cost, pom_vis_clicks) AS pom_vis_lc_cost_per_clicks
      , SAFE_DIVIDE(pom_vis_lc_cost, pom_vis_impressions) AS pom_vis_lc_cost_per_impressions
      , SAFE_DIVIDE(pom_vis_lc_cost, pom_vis_user_touch_point) AS pom_vis_lc_cost_per_user_touch_point
      , SAFE_DIVIDE(pom_vis_lc_cost, pom_vis_motors_timedecay_contact_attribution) AS pom_vis_lc_cost_per_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_lc_cost, pom_vis_motors_user_contact) AS pom_vis_lc_cost_per_user_contact
      , SAFE_DIVIDE(pom_vis_lc_cost, pom_vis_motors_item_contacted) AS pom_vis_lc_cost_per_item_contacted
      , SAFE_DIVIDE(pom_vis_lc_cost, pom_vis_motors_seller_contacted) AS pom_vis_lc_cost_per_seller_contacted

      , SAFE_DIVIDE(pom_vis_usd_cost, pom_vis_clicks) AS pom_vis_usd_cost_per_clicks
      , SAFE_DIVIDE(pom_vis_usd_cost, pom_vis_impressions) AS pom_vis_usd_cost_per_impressions
      , SAFE_DIVIDE(pom_vis_usd_cost, pom_vis_user_touch_point) AS pom_vis_usd_cost_per_user_touch_point
      , SAFE_DIVIDE(pom_vis_usd_cost, pom_vis_motors_timedecay_contact_attribution) AS pom_vis_usd_cost_per_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_usd_cost, pom_vis_motors_user_contact) AS pom_vis_usd_cost_per_user_contact
      , SAFE_DIVIDE(pom_vis_usd_cost, pom_vis_motors_item_contacted) AS pom_vis_usd_cost_per_item_contacted
      , SAFE_DIVIDE(pom_vis_usd_cost, pom_vis_motors_seller_contacted) AS pom_vis_usd_cost_per_seller_contacted


   ------------------------
    -- DIRECT
    ------------------------
      -- leads
      , direct_motors_timedecay_contact_attribution
      , direct_motors_user_contact
      , SAFE_DIVIDE(direct_motors_timedecay_contact_attribution, direct_motors_user_contact) AS avg_direct_motors_contact_per_user
      , direct_motors_user_logg_contact
      , direct_motors_user_not_logg_contact
      , SAFE_DIVIDE(direct_motors_user_logg_contact, ( COALESCE(direct_motors_user_logg_contact, 0) + COALESCE(direct_motors_user_not_logg_contact,0) ) ) AS perc_direct_motors_user_logg_contact
      , SAFE_DIVIDE(direct_motors_user_not_logg_contact, ( COALESCE(direct_motors_user_logg_contact, 0) + COALESCE(direct_motors_user_not_logg_contact,0) ) ) AS perc_direct_motors_user_not_logg_contact
      , direct_motors_item_contacted
      , SAFE_DIVIDE(direct_motors_timedecay_contact_attribution, direct_motors_item_contacted) AS avg_direct_motors_item_contacted
      , direct_motors_seller_contacted
      , SAFE_DIVIDE(direct_motors_timedecay_contact_attribution, direct_motors_seller_contacted) AS avg_direct_motors_seller_contacted


   ------------------------
    -- SEO
    ------------------------
      -- leads
      , seo_motors_timedecay_contact_attribution
      , seo_motors_user_contact
      , SAFE_DIVIDE(seo_motors_timedecay_contact_attribution, seo_motors_user_contact) AS avg_seo_motors_contact_per_user
      , seo_motors_user_logg_contact
      , seo_motors_user_not_logg_contact
      , SAFE_DIVIDE(seo_motors_user_logg_contact, ( COALESCE(seo_motors_user_logg_contact, 0) + COALESCE(seo_motors_user_not_logg_contact,0) ) ) AS perc_seo_motors_user_logg_contact
      , SAFE_DIVIDE(seo_motors_user_not_logg_contact, ( COALESCE(seo_motors_user_logg_contact, 0) + COALESCE(seo_motors_user_not_logg_contact,0) ) ) AS perc_seo_motors_user_not_logg_contact
      , seo_motors_item_contacted
      , SAFE_DIVIDE(seo_motors_timedecay_contact_attribution, seo_motors_item_contacted) AS avg_seo_motors_item_contacted
      , seo_motors_seller_contacted
      , SAFE_DIVIDE(seo_motors_timedecay_contact_attribution, seo_motors_seller_contacted) AS avg_seo_motors_seller_contacted

   ------------------------
    -- OWN CHANNELS
    ------------------------
      -- leads
      , own_channels_motors_timedecay_contact_attribution
      , own_channels_motors_user_contact
      , SAFE_DIVIDE(own_channels_motors_timedecay_contact_attribution, own_channels_motors_user_contact) AS avg_own_channels_motors_contact_per_user
      , own_channels_motors_user_logg_contact
      , own_channels_motors_user_not_logg_contact
      , SAFE_DIVIDE(own_channels_motors_user_logg_contact, ( COALESCE(own_channels_motors_user_logg_contact, 0) + COALESCE(own_channels_motors_user_not_logg_contact,0) ) ) AS perc_own_channels_motors_user_logg_contact
      , SAFE_DIVIDE(own_channels_motors_user_not_logg_contact, ( COALESCE(own_channels_motors_user_logg_contact, 0) + COALESCE(own_channels_motors_user_not_logg_contact,0) ) ) AS perc_own_channels_motors_user_not_logg_contact
      , own_channels_motors_item_contacted
      , SAFE_DIVIDE(own_channels_motors_timedecay_contact_attribution, own_channels_motors_item_contacted) AS avg_own_channels_motors_item_contacted
      , own_channels_motors_seller_contacted
      , SAFE_DIVIDE(own_channels_motors_timedecay_contact_attribution, own_channels_motors_seller_contacted) AS avg_own_channels_motors_seller_contacted

   ------------------------
    -- MATT OTHER
    ------------------------
      -- leads
      , matt_other_motors_timedecay_contact_attribution
      , matt_other_motors_user_contact
      , SAFE_DIVIDE(matt_other_motors_timedecay_contact_attribution, matt_other_motors_user_contact) AS avg_matt_other_motors_contact_per_user
      , matt_other_motors_user_logg_contact
      , matt_other_motors_user_not_logg_contact
      , SAFE_DIVIDE(matt_other_motors_user_logg_contact, ( COALESCE(matt_other_motors_user_logg_contact, 0) + COALESCE(matt_other_motors_user_not_logg_contact,0) ) ) AS perc_matt_other_motors_user_logg_contact
      , SAFE_DIVIDE(matt_other_motors_user_not_logg_contact, ( COALESCE(matt_other_motors_user_logg_contact, 0) + COALESCE(matt_other_motors_user_not_logg_contact,0) ) ) AS perc_matt_other_motors_user_not_logg_contact
      , matt_other_motors_item_contacted
      , SAFE_DIVIDE(matt_other_motors_timedecay_contact_attribution, matt_other_motors_item_contacted) AS avg_matt_other_motors_item_contacted
      , matt_other_motors_seller_contacted
      , SAFE_DIVIDE(matt_other_motors_timedecay_contact_attribution, matt_other_motors_seller_contacted) AS avg_matt_other_motors_seller_contacted

   ------------------------
    -- POM VIS DESVIO
    ------------------------
      -- leads
      , pom_vis_desvio_motors_timedecay_contact_attribution
      , pom_vis_desvio_motors_user_contact
      , SAFE_DIVIDE(pom_vis_desvio_motors_timedecay_contact_attribution, pom_vis_desvio_motors_user_contact) AS avg_pom_vis_desvio_motors_contact_per_user
      , pom_vis_desvio_motors_user_logg_contact
      , pom_vis_desvio_motors_user_not_logg_contact
      , SAFE_DIVIDE(pom_vis_desvio_motors_user_logg_contact, ( COALESCE(pom_vis_desvio_motors_user_logg_contact, 0) + COALESCE(pom_vis_desvio_motors_user_not_logg_contact,0) ) ) AS perc_pom_vis_desvio_motors_user_logg_contact
      , SAFE_DIVIDE(pom_vis_desvio_motors_user_not_logg_contact, ( COALESCE(pom_vis_desvio_motors_user_logg_contact, 0) + COALESCE(pom_vis_desvio_motors_user_not_logg_contact,0) ) ) AS perc_pom_vis_desvio_motors_user_not_logg_contact
      , pom_vis_desvio_motors_item_contacted
      , SAFE_DIVIDE(pom_vis_desvio_motors_timedecay_contact_attribution, pom_vis_desvio_motors_item_contacted) AS avg_pom_vis_desvio_motors_item_contacted
      , pom_vis_desvio_motors_seller_contacted
      , SAFE_DIVIDE(pom_vis_desvio_motors_timedecay_contact_attribution, pom_vis_desvio_motors_seller_contacted) AS avg_pom_vis_desvio_motors_seller_contacted


   ------------------------
    -- GOOGLE SEARCH (POM VIS)
    ------------------------
      -- leads
      , pom_vis_google_search_motors_timedecay_contact_attribution
      , pom_vis_google_search_motors_user_contact
      , SAFE_DIVIDE(pom_vis_google_search_motors_timedecay_contact_attribution, pom_vis_google_search_motors_user_contact) AS avg_pom_vis_google_search_motors_contact_per_user
      , pom_vis_google_search_motors_user_logg_contact
      , pom_vis_google_search_motors_user_not_logg_contact
      , SAFE_DIVIDE(pom_vis_google_search_motors_user_logg_contact, ( COALESCE(pom_vis_google_search_motors_user_logg_contact, 0) + COALESCE(pom_vis_google_search_motors_user_not_logg_contact,0) ) ) AS perc_pom_vis_google_search_motors_user_logg_contact
      , SAFE_DIVIDE(pom_vis_google_search_motors_user_not_logg_contact, ( COALESCE(pom_vis_google_search_motors_user_logg_contact, 0) + COALESCE(pom_vis_google_search_motors_user_not_logg_contact,0) ) ) AS perc_pom_vis_google_search_motors_user_not_logg_contact
      , pom_vis_google_search_motors_item_contacted
      , SAFE_DIVIDE(pom_vis_google_search_motors_timedecay_contact_attribution, pom_vis_google_search_motors_item_contacted) AS avg_pom_vis_google_search_motors_item_contacted
      , pom_vis_google_search_motors_seller_contacted
      , SAFE_DIVIDE(pom_vis_google_search_motors_timedecay_contact_attribution, pom_vis_google_search_motors_seller_contacted) AS avg_pom_vis_google_search_motors_seller_contacted

      -- touchpoints
      , pom_vis_google_search_user_touch_point
      , pom_vis_google_search_user_logg_touch_point
      , pom_vis_google_search_user_not_logg_touch_point
      , SAFE_DIVIDE(pom_vis_google_search_user_logg_touch_point, ( COALESCE(pom_vis_google_search_user_logg_touch_point, 0) + COALESCE(pom_vis_google_search_user_not_logg_touch_point, 0) ) ) AS perc_pom_vis_google_search_user_logg_touch_point
      , SAFE_DIVIDE(pom_vis_google_search_user_not_logg_touch_point, ( COALESCE(pom_vis_google_search_user_logg_touch_point, 0) + COALESCE(pom_vis_google_search_user_not_logg_touch_point, 0) ) ) AS perc_pom_vis_google_search_user_not_logg_touch_point

      -- cost clicks impressions
      , pom_vis_google_search_clicks
      , pom_vis_google_search_impressions
      , pom_vis_google_search_usd_cost
      , pom_vis_google_search_lc_cost
      , SAFE_DIVIDE(pom_vis_google_search_lc_cost, pom_vis_google_search_clicks) AS pom_vis_google_search_lc_cost_per_clicks
      , SAFE_DIVIDE(pom_vis_google_search_lc_cost, pom_vis_google_search_impressions) AS pom_vis_google_search_lc_cost_per_impressions
      , SAFE_DIVIDE(pom_vis_google_search_lc_cost, pom_vis_google_search_user_touch_point) AS pom_vis_google_search_lc_cost_per_user_touch_point
      , SAFE_DIVIDE(pom_vis_google_search_lc_cost, pom_vis_google_search_motors_timedecay_contact_attribution) AS pom_vis_google_search_lc_cost_per_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_google_search_lc_cost, pom_vis_google_search_motors_user_contact) AS pom_vis_google_search_lc_cost_per_user_contact
      , SAFE_DIVIDE(pom_vis_google_search_lc_cost, pom_vis_google_search_motors_item_contacted) AS pom_vis_google_search_lc_cost_per_item_contacted
      , SAFE_DIVIDE(pom_vis_google_search_lc_cost, pom_vis_google_search_motors_seller_contacted) AS pom_vis_google_search_lc_cost_per_seller_contacted

      , SAFE_DIVIDE(pom_vis_google_search_usd_cost, pom_vis_google_search_clicks) AS pom_vis_google_search_usd_cost_per_clicks
      , SAFE_DIVIDE(pom_vis_google_search_usd_cost, pom_vis_google_search_impressions) AS pom_vis_google_search_usd_cost_per_impressions
      , SAFE_DIVIDE(pom_vis_google_search_usd_cost, pom_vis_google_search_user_touch_point) AS pom_vis_google_search_usd_cost_per_user_touch_point
      , SAFE_DIVIDE(pom_vis_google_search_usd_cost, pom_vis_google_search_motors_timedecay_contact_attribution) AS pom_vis_google_search_usd_cost_per_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_google_search_usd_cost, pom_vis_google_search_motors_user_contact) AS pom_vis_google_search_usd_cost_per_user_contact
      , SAFE_DIVIDE(pom_vis_google_search_usd_cost, pom_vis_google_search_motors_item_contacted) AS pom_vis_google_search_usd_cost_per_item_contacted
      , SAFE_DIVIDE(pom_vis_google_search_usd_cost, pom_vis_google_search_motors_seller_contacted) AS pom_vis_google_search_usd_cost_per_seller_contacted


   ------------------------
    -- GOOGLE DISPLAY (POM VIS)
    ------------------------
      -- leads
      , pom_vis_google_display_motors_timedecay_contact_attribution
      , pom_vis_google_display_motors_user_contact
      , SAFE_DIVIDE(pom_vis_google_display_motors_timedecay_contact_attribution, pom_vis_google_display_motors_user_contact) AS avg_pom_vis_google_display_motors_contact_per_user
      , pom_vis_google_display_motors_user_logg_contact
      , pom_vis_google_display_motors_user_not_logg_contact
      , SAFE_DIVIDE(pom_vis_google_display_motors_user_logg_contact, ( COALESCE(pom_vis_google_display_motors_user_logg_contact, 0) + COALESCE(pom_vis_google_display_motors_user_not_logg_contact,0) ) ) AS perc_pom_vis_google_display_motors_user_logg_contact
      , SAFE_DIVIDE(pom_vis_google_display_motors_user_not_logg_contact, ( COALESCE(pom_vis_google_display_motors_user_logg_contact, 0) + COALESCE(pom_vis_google_display_motors_user_not_logg_contact,0) ) ) AS perc_pom_vis_google_display_motors_user_not_logg_contact
      , pom_vis_google_display_motors_item_contacted
      , SAFE_DIVIDE(pom_vis_google_display_motors_timedecay_contact_attribution, pom_vis_google_display_motors_item_contacted) AS avg_pom_vis_google_display_motors_item_contacted
      , pom_vis_google_display_motors_seller_contacted
      , SAFE_DIVIDE(pom_vis_google_display_motors_timedecay_contact_attribution, pom_vis_google_display_motors_seller_contacted) AS avg_pom_vis_google_display_motors_seller_contacted

      -- touchpoints
      , pom_vis_google_display_user_touch_point
      , pom_vis_google_display_user_logg_touch_point
      , pom_vis_google_display_user_not_logg_touch_point
      , SAFE_DIVIDE(pom_vis_google_display_user_logg_touch_point, ( COALESCE(pom_vis_google_display_user_logg_touch_point, 0) + COALESCE(pom_vis_google_display_user_not_logg_touch_point, 0) ) ) AS perc_pom_vis_google_display_user_logg_touch_point
      , SAFE_DIVIDE(pom_vis_google_display_user_not_logg_touch_point, ( COALESCE(pom_vis_google_display_user_logg_touch_point, 0) + COALESCE(pom_vis_google_display_user_not_logg_touch_point, 0) ) ) AS perc_pom_vis_google_display_user_not_logg_touch_point

      -- cost clicks impressions
      , pom_vis_google_display_clicks
      , pom_vis_google_display_impressions
      , pom_vis_google_display_usd_cost
      , pom_vis_google_display_lc_cost
      , SAFE_DIVIDE(pom_vis_google_display_lc_cost, pom_vis_google_display_clicks) AS pom_vis_google_display_lc_cost_per_clicks
      , SAFE_DIVIDE(pom_vis_google_display_lc_cost, pom_vis_google_display_impressions) AS pom_vis_google_display_lc_cost_per_impressions
      , SAFE_DIVIDE(pom_vis_google_display_lc_cost, pom_vis_google_display_user_touch_point) AS pom_vis_google_display_lc_cost_per_user_touch_point
      , SAFE_DIVIDE(pom_vis_google_display_lc_cost, pom_vis_google_display_motors_timedecay_contact_attribution) AS pom_vis_google_display_lc_cost_per_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_google_display_lc_cost, pom_vis_google_display_motors_user_contact) AS pom_vis_google_display_lc_cost_per_user_contact
      , SAFE_DIVIDE(pom_vis_google_display_lc_cost, pom_vis_google_display_motors_item_contacted) AS pom_vis_google_display_lc_cost_per_item_contacted
      , SAFE_DIVIDE(pom_vis_google_display_lc_cost, pom_vis_google_display_motors_seller_contacted) AS pom_vis_google_display_lc_cost_per_seller_contacted

      , SAFE_DIVIDE(pom_vis_google_display_usd_cost, pom_vis_google_display_clicks) AS pom_vis_google_display_usd_cost_per_clicks
      , SAFE_DIVIDE(pom_vis_google_display_usd_cost, pom_vis_google_display_impressions) AS pom_vis_google_display_usd_cost_per_impressions
      , SAFE_DIVIDE(pom_vis_google_display_usd_cost, pom_vis_google_display_user_touch_point) AS pom_vis_google_display_usd_cost_per_user_touch_point
      , SAFE_DIVIDE(pom_vis_google_display_usd_cost, pom_vis_google_display_motors_timedecay_contact_attribution) AS pom_vis_google_display_usd_cost_per_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_google_display_usd_cost, pom_vis_google_display_motors_user_contact) AS pom_vis_google_display_usd_cost_per_user_contact
      , SAFE_DIVIDE(pom_vis_google_display_usd_cost, pom_vis_google_display_motors_item_contacted) AS pom_vis_google_display_usd_cost_per_item_contacted
      , SAFE_DIVIDE(pom_vis_google_display_usd_cost, pom_vis_google_display_motors_seller_contacted) AS pom_vis_google_display_usd_cost_per_seller_contacted


   ------------------------
    -- FACEBOOK (POM VIS)
    ------------------------
      -- leads
      , pom_vis_facebook_motors_timedecay_contact_attribution
      , pom_vis_facebook_motors_user_contact
      , SAFE_DIVIDE(pom_vis_facebook_motors_timedecay_contact_attribution, pom_vis_facebook_motors_user_contact) AS avg_pom_vis_facebook_motors_contact_per_user
      , pom_vis_facebook_motors_user_logg_contact
      , pom_vis_facebook_motors_user_not_logg_contact
      , SAFE_DIVIDE(pom_vis_facebook_motors_user_logg_contact, ( COALESCE(pom_vis_facebook_motors_user_logg_contact, 0) + COALESCE(pom_vis_facebook_motors_user_not_logg_contact,0) ) ) AS perc_pom_vis_facebook_motors_user_logg_contact
      , SAFE_DIVIDE(pom_vis_facebook_motors_user_not_logg_contact, ( COALESCE(pom_vis_facebook_motors_user_logg_contact, 0) + COALESCE(pom_vis_facebook_motors_user_not_logg_contact,0) ) ) AS perc_pom_vis_facebook_motors_user_not_logg_contact
      , pom_vis_facebook_motors_item_contacted
      , SAFE_DIVIDE(pom_vis_facebook_motors_timedecay_contact_attribution, pom_vis_facebook_motors_item_contacted) AS avg_pom_vis_facebook_motors_item_contacted
      , pom_vis_facebook_motors_seller_contacted
      , SAFE_DIVIDE(pom_vis_facebook_motors_timedecay_contact_attribution, pom_vis_facebook_motors_seller_contacted) AS avg_pom_vis_facebook_motors_seller_contacted

      -- touchpoints
      , pom_vis_facebook_user_touch_point
      , pom_vis_facebook_user_logg_touch_point
      , pom_vis_facebook_user_not_logg_touch_point
      , SAFE_DIVIDE(pom_vis_facebook_user_logg_touch_point, ( COALESCE(pom_vis_facebook_user_logg_touch_point, 0) + COALESCE(pom_vis_facebook_user_not_logg_touch_point, 0) ) ) AS perc_pom_vis_facebook_user_logg_touch_point
      , SAFE_DIVIDE(pom_vis_facebook_user_not_logg_touch_point, ( COALESCE(pom_vis_facebook_user_logg_touch_point, 0) + COALESCE(pom_vis_facebook_user_not_logg_touch_point, 0) ) ) AS perc_pom_vis_facebook_user_not_logg_touch_point

      -- cost clicks impressions
      , pom_vis_facebook_clicks
      , pom_vis_facebook_impressions
      , pom_vis_facebook_usd_cost
      , pom_vis_facebook_lc_cost
      , SAFE_DIVIDE(pom_vis_facebook_lc_cost, pom_vis_facebook_clicks) AS pom_vis_facebook_lc_cost_per_clicks
      , SAFE_DIVIDE(pom_vis_facebook_lc_cost, pom_vis_facebook_impressions) AS pom_vis_facebook_lc_cost_per_impressions
      , SAFE_DIVIDE(pom_vis_facebook_lc_cost, pom_vis_facebook_user_touch_point) AS pom_vis_facebook_lc_cost_per_user_touch_point
      , SAFE_DIVIDE(pom_vis_facebook_lc_cost, pom_vis_facebook_motors_timedecay_contact_attribution) AS pom_vis_facebook_lc_cost_per_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_facebook_lc_cost, pom_vis_facebook_motors_user_contact) AS pom_vis_facebook_lc_cost_per_user_contact
      , SAFE_DIVIDE(pom_vis_facebook_lc_cost, pom_vis_facebook_motors_item_contacted) AS pom_vis_facebook_lc_cost_per_item_contacted
      , SAFE_DIVIDE(pom_vis_facebook_lc_cost, pom_vis_facebook_motors_seller_contacted) AS pom_vis_facebook_lc_cost_per_seller_contacted

      , SAFE_DIVIDE(pom_vis_facebook_usd_cost, pom_vis_facebook_clicks) AS pom_vis_facebook_usd_cost_per_clicks
      , SAFE_DIVIDE(pom_vis_facebook_usd_cost, pom_vis_facebook_impressions) AS pom_vis_facebook_usd_cost_per_impressions
      , SAFE_DIVIDE(pom_vis_facebook_usd_cost, pom_vis_facebook_user_touch_point) AS pom_vis_facebook_usd_cost_per_user_touch_point
      , SAFE_DIVIDE(pom_vis_facebook_usd_cost, pom_vis_facebook_motors_timedecay_contact_attribution) AS pom_vis_facebook_usd_cost_per_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_facebook_usd_cost, pom_vis_facebook_motors_user_contact) AS pom_vis_facebook_usd_cost_per_user_contact
      , SAFE_DIVIDE(pom_vis_facebook_usd_cost, pom_vis_facebook_motors_item_contacted) AS pom_vis_facebook_usd_cost_per_item_contacted
      , SAFE_DIVIDE(pom_vis_facebook_usd_cost, pom_vis_facebook_motors_seller_contacted) AS pom_vis_facebook_usd_cost_per_seller_contacted

   ------------------------
    -- FACEBOOK (POM VIS)
    ------------------------
      -- leads
      , pom_vis_facebook_forms_motors_timedecay_contact_attribution
      , pom_vis_facebook_forms_motors_user_contact
      , SAFE_DIVIDE(pom_vis_facebook_forms_motors_timedecay_contact_attribution, pom_vis_facebook_forms_motors_user_contact) AS avg_pom_vis_facebook_forms_motors_contact_per_user
      , pom_vis_facebook_forms_motors_user_logg_contact
      , pom_vis_facebook_forms_motors_user_not_logg_contact
      , SAFE_DIVIDE(pom_vis_facebook_forms_motors_user_logg_contact, ( COALESCE(pom_vis_facebook_forms_motors_user_logg_contact, 0) + COALESCE(pom_vis_facebook_forms_motors_user_not_logg_contact,0) ) ) AS perc_pom_vis_facebook_forms_motors_user_logg_contact
      , SAFE_DIVIDE(pom_vis_facebook_forms_motors_user_not_logg_contact, ( COALESCE(pom_vis_facebook_forms_motors_user_logg_contact, 0) + COALESCE(pom_vis_facebook_forms_motors_user_not_logg_contact,0) ) ) AS perc_pom_vis_facebook_forms_motors_user_not_logg_contact
      , pom_vis_facebook_forms_motors_item_contacted
      , SAFE_DIVIDE(pom_vis_facebook_forms_motors_timedecay_contact_attribution, pom_vis_facebook_forms_motors_item_contacted) AS avg_pom_vis_facebook_forms_motors_item_contacted
      , pom_vis_facebook_forms_motors_seller_contacted
      , SAFE_DIVIDE(pom_vis_facebook_forms_motors_timedecay_contact_attribution, pom_vis_facebook_forms_motors_seller_contacted) AS avg_pom_vis_facebook_forms_motors_seller_contacted

      -- touchpoints
      , pom_vis_facebook_forms_user_touch_point
      , pom_vis_facebook_forms_user_logg_touch_point
      , pom_vis_facebook_forms_user_not_logg_touch_point
      , SAFE_DIVIDE(pom_vis_facebook_forms_user_logg_touch_point, ( COALESCE(pom_vis_facebook_forms_user_logg_touch_point, 0) + COALESCE(pom_vis_facebook_forms_user_not_logg_touch_point, 0) ) ) AS perc_pom_vis_facebook_forms_user_logg_touch_point
      , SAFE_DIVIDE(pom_vis_facebook_forms_user_not_logg_touch_point, ( COALESCE(pom_vis_facebook_forms_user_logg_touch_point, 0) + COALESCE(pom_vis_facebook_forms_user_not_logg_touch_point, 0) ) ) AS perc_pom_vis_facebook_forms_user_not_logg_touch_point

      -- cost clicks impressions
      , pom_vis_facebook_forms_clicks
      , pom_vis_facebook_forms_impressions
      , pom_vis_facebook_forms_usd_cost
      , pom_vis_facebook_forms_lc_cost
      , SAFE_DIVIDE(pom_vis_facebook_forms_lc_cost, pom_vis_facebook_forms_clicks) AS pom_vis_facebook_forms_lc_cost_per_clicks
      , SAFE_DIVIDE(pom_vis_facebook_forms_lc_cost, pom_vis_facebook_forms_impressions) AS pom_vis_facebook_forms_lc_cost_per_impressions
      , SAFE_DIVIDE(pom_vis_facebook_forms_lc_cost, pom_vis_facebook_forms_user_touch_point) AS pom_vis_facebook_forms_lc_cost_per_user_touch_point
      , SAFE_DIVIDE(pom_vis_facebook_forms_lc_cost, pom_vis_facebook_forms_motors_timedecay_contact_attribution) AS pom_vis_facebook_forms_lc_cost_per_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_facebook_forms_lc_cost, pom_vis_facebook_forms_motors_user_contact) AS pom_vis_facebook_forms_lc_cost_per_user_contact
      , SAFE_DIVIDE(pom_vis_facebook_forms_lc_cost, pom_vis_facebook_forms_motors_item_contacted) AS pom_vis_facebook_forms_lc_cost_per_item_contacted
      , SAFE_DIVIDE(pom_vis_facebook_forms_lc_cost, pom_vis_facebook_forms_motors_seller_contacted) AS pom_vis_facebook_forms_lc_cost_per_seller_contacted

      , SAFE_DIVIDE(pom_vis_facebook_forms_usd_cost, pom_vis_facebook_forms_clicks) AS pom_vis_facebook_forms_usd_cost_per_clicks
      , SAFE_DIVIDE(pom_vis_facebook_forms_usd_cost, pom_vis_facebook_forms_impressions) AS pom_vis_facebook_forms_usd_cost_per_impressions
      , SAFE_DIVIDE(pom_vis_facebook_forms_usd_cost, pom_vis_facebook_forms_user_touch_point) AS pom_vis_facebook_forms_usd_cost_per_user_touch_point
      , SAFE_DIVIDE(pom_vis_facebook_forms_usd_cost, pom_vis_facebook_forms_motors_timedecay_contact_attribution) AS pom_vis_facebook_forms_usd_cost_per_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_facebook_forms_usd_cost, pom_vis_facebook_forms_motors_user_contact) AS pom_vis_facebook_forms_usd_cost_per_user_contact
      , SAFE_DIVIDE(pom_vis_facebook_forms_usd_cost, pom_vis_facebook_forms_motors_item_contacted) AS pom_vis_facebook_forms_usd_cost_per_item_contacted
      , SAFE_DIVIDE(pom_vis_facebook_forms_usd_cost, pom_vis_facebook_forms_motors_seller_contacted) AS pom_vis_facebook_forms_usd_cost_per_seller_contacted

   ------------------------
    -- RTB (POM VIS)
    ------------------------
      -- leads
      , pom_vis_rtb_motors_timedecay_contact_attribution
      , pom_vis_rtb_motors_user_contact
      , SAFE_DIVIDE(pom_vis_rtb_motors_timedecay_contact_attribution, pom_vis_rtb_motors_user_contact) AS avg_pom_vis_rtb_motors_contact_per_user
      , pom_vis_rtb_motors_user_logg_contact
      , pom_vis_rtb_motors_user_not_logg_contact
      , SAFE_DIVIDE(pom_vis_rtb_motors_user_logg_contact, ( COALESCE(pom_vis_rtb_motors_user_logg_contact, 0) + COALESCE(pom_vis_rtb_motors_user_not_logg_contact,0) ) ) AS perc_pom_vis_rtb_motors_user_logg_contact
      , SAFE_DIVIDE(pom_vis_rtb_motors_user_not_logg_contact, ( COALESCE(pom_vis_rtb_motors_user_logg_contact, 0) + COALESCE(pom_vis_rtb_motors_user_not_logg_contact,0) ) ) AS perc_pom_vis_rtb_motors_user_not_logg_contact
      , pom_vis_rtb_motors_item_contacted
      , SAFE_DIVIDE(pom_vis_rtb_motors_timedecay_contact_attribution, pom_vis_rtb_motors_item_contacted) AS avg_pom_vis_rtb_motors_item_contacted
      , pom_vis_rtb_motors_seller_contacted
      , SAFE_DIVIDE(pom_vis_rtb_motors_timedecay_contact_attribution, pom_vis_rtb_motors_seller_contacted) AS avg_pom_vis_rtb_motors_seller_contacted

      -- touchpoints
      , pom_vis_rtb_user_touch_point
      , pom_vis_rtb_user_logg_touch_point
      , pom_vis_rtb_user_not_logg_touch_point
      , SAFE_DIVIDE(pom_vis_rtb_user_logg_touch_point, ( COALESCE(pom_vis_rtb_user_logg_touch_point, 0) + COALESCE(pom_vis_rtb_user_not_logg_touch_point, 0) ) ) AS perc_pom_vis_rtb_user_logg_touch_point
      , SAFE_DIVIDE(pom_vis_rtb_user_not_logg_touch_point, ( COALESCE(pom_vis_rtb_user_logg_touch_point, 0) + COALESCE(pom_vis_rtb_user_not_logg_touch_point, 0) ) ) AS perc_pom_vis_rtb_user_not_logg_touch_point

      -- cost clicks impressions
      , pom_vis_rtb_clicks
      , pom_vis_rtb_impressions
      , pom_vis_rtb_usd_cost
      , pom_vis_rtb_lc_cost
      , SAFE_DIVIDE(pom_vis_rtb_lc_cost, pom_vis_rtb_clicks) AS pom_vis_rtb_lc_cost_per_clicks
      , SAFE_DIVIDE(pom_vis_rtb_lc_cost, pom_vis_rtb_impressions) AS pom_vis_rtb_lc_cost_per_impressions
      , SAFE_DIVIDE(pom_vis_rtb_lc_cost, pom_vis_rtb_user_touch_point) AS pom_vis_rtb_lc_cost_per_user_touch_point
      , SAFE_DIVIDE(pom_vis_rtb_lc_cost, pom_vis_rtb_motors_timedecay_contact_attribution) AS pom_vis_rtb_lc_cost_per_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_rtb_lc_cost, pom_vis_rtb_motors_user_contact) AS pom_vis_rtb_lc_cost_per_user_contact
      , SAFE_DIVIDE(pom_vis_rtb_lc_cost, pom_vis_rtb_motors_item_contacted) AS pom_vis_rtb_lc_cost_per_item_contacted
      , SAFE_DIVIDE(pom_vis_rtb_lc_cost, pom_vis_rtb_motors_seller_contacted) AS pom_vis_rtb_lc_cost_per_seller_contacted

      , SAFE_DIVIDE(pom_vis_rtb_usd_cost, pom_vis_rtb_clicks) AS pom_vis_rtb_usd_cost_per_clicks
      , SAFE_DIVIDE(pom_vis_rtb_usd_cost, pom_vis_rtb_impressions) AS pom_vis_rtb_usd_cost_per_impressions
      , SAFE_DIVIDE(pom_vis_rtb_usd_cost, pom_vis_rtb_user_touch_point) AS pom_vis_rtb_usd_cost_per_user_touch_point
      , SAFE_DIVIDE(pom_vis_rtb_usd_cost, pom_vis_rtb_motors_timedecay_contact_attribution) AS pom_vis_rtb_usd_cost_per_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_rtb_usd_cost, pom_vis_rtb_motors_user_contact) AS pom_vis_rtb_usd_cost_per_user_contact
      , SAFE_DIVIDE(pom_vis_rtb_usd_cost, pom_vis_rtb_motors_item_contacted) AS pom_vis_rtb_usd_cost_per_item_contacted
      , SAFE_DIVIDE(pom_vis_rtb_usd_cost, pom_vis_rtb_motors_seller_contacted) AS pom_vis_rtb_usd_cost_per_seller_contacted

   ------------------------
    -- OTHER POM VIS
    ------------------------
      -- leads
      , pom_vis_other_motors_timedecay_contact_attribution
      , pom_vis_other_motors_user_contact
      , SAFE_DIVIDE(pom_vis_other_motors_timedecay_contact_attribution, pom_vis_other_motors_user_contact) AS avg_pom_vis_other_motors_contact_per_user
      , pom_vis_other_motors_user_logg_contact
      , pom_vis_other_motors_user_not_logg_contact
      , SAFE_DIVIDE(pom_vis_other_motors_user_logg_contact, ( COALESCE(pom_vis_other_motors_user_logg_contact, 0) + COALESCE(pom_vis_other_motors_user_not_logg_contact,0) ) ) AS perc_pom_vis_other_motors_user_logg_contact
      , SAFE_DIVIDE(pom_vis_other_motors_user_not_logg_contact, ( COALESCE(pom_vis_other_motors_user_logg_contact, 0) + COALESCE(pom_vis_other_motors_user_not_logg_contact,0) ) ) AS perc_pom_vis_other_motors_user_not_logg_contact
      , pom_vis_other_motors_item_contacted
      , SAFE_DIVIDE(pom_vis_other_motors_timedecay_contact_attribution, pom_vis_other_motors_item_contacted) AS avg_pom_vis_other_motors_item_contacted
      , pom_vis_other_motors_seller_contacted
      , SAFE_DIVIDE(pom_vis_other_motors_timedecay_contact_attribution, pom_vis_other_motors_seller_contacted) AS avg_pom_vis_other_motors_seller_contacted

      -- touchpoints
      , pom_vis_other_user_touch_point
      , pom_vis_other_user_logg_touch_point
      , pom_vis_other_user_not_logg_touch_point
      , SAFE_DIVIDE(pom_vis_other_user_logg_touch_point, ( COALESCE(pom_vis_other_user_logg_touch_point, 0) + COALESCE(pom_vis_other_user_not_logg_touch_point, 0) ) ) AS perc_pom_vis_other_user_logg_touch_point
      , SAFE_DIVIDE(pom_vis_other_user_not_logg_touch_point, ( COALESCE(pom_vis_other_user_logg_touch_point, 0) + COALESCE(pom_vis_other_user_not_logg_touch_point, 0) ) ) AS perc_pom_vis_other_user_not_logg_touch_point

      -- cost clicks impressions
      , pom_vis_other_clicks
      , pom_vis_other_impressions
      , pom_vis_other_usd_cost
      , pom_vis_other_lc_cost
      , SAFE_DIVIDE(pom_vis_other_lc_cost, pom_vis_other_clicks) AS pom_vis_other_lc_cost_per_clicks
      , SAFE_DIVIDE(pom_vis_other_lc_cost, pom_vis_other_impressions) AS pom_vis_other_lc_cost_per_impressions
      , SAFE_DIVIDE(pom_vis_other_lc_cost, pom_vis_other_user_touch_point) AS pom_vis_other_lc_cost_per_user_touch_point
      , SAFE_DIVIDE(pom_vis_other_lc_cost, pom_vis_other_motors_timedecay_contact_attribution) AS pom_vis_other_lc_cost_per_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_other_lc_cost, pom_vis_other_motors_user_contact) AS pom_vis_other_lc_cost_per_user_contact
      , SAFE_DIVIDE(pom_vis_other_lc_cost, pom_vis_other_motors_item_contacted) AS pom_vis_other_lc_cost_per_item_contacted
      , SAFE_DIVIDE(pom_vis_other_lc_cost, pom_vis_other_motors_seller_contacted) AS pom_vis_other_lc_cost_per_seller_contacted

      , SAFE_DIVIDE(pom_vis_other_usd_cost, pom_vis_other_clicks) AS pom_vis_other_usd_cost_per_clicks
      , SAFE_DIVIDE(pom_vis_other_usd_cost, pom_vis_other_impressions) AS pom_vis_other_usd_cost_per_impressions
      , SAFE_DIVIDE(pom_vis_other_usd_cost, pom_vis_other_user_touch_point) AS pom_vis_other_usd_cost_per_user_touch_point
      , SAFE_DIVIDE(pom_vis_other_usd_cost, pom_vis_other_motors_timedecay_contact_attribution) AS pom_vis_other_usd_cost_per_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_other_usd_cost, pom_vis_other_motors_user_contact) AS pom_vis_other_usd_cost_per_user_contact
      , SAFE_DIVIDE(pom_vis_other_usd_cost, pom_vis_other_motors_item_contacted) AS pom_vis_other_usd_cost_per_item_contacted
      , SAFE_DIVIDE(pom_vis_other_usd_cost, pom_vis_other_motors_seller_contacted) AS pom_vis_other_usd_cost_per_seller_contacted

   ------------------------
    -- XP: contactos CON exclusion
    ------------------------
      -- leads
      , pom_vis_xp_contact_user_con_exclusion_motors_timedecay_contact_attribution
      , pom_vis_xp_contact_user_con_exclusion_motors_user_contact
      , SAFE_DIVIDE(pom_vis_xp_contact_user_con_exclusion_motors_timedecay_contact_attribution, pom_vis_xp_contact_user_con_exclusion_motors_user_contact) AS avg_pom_vis_xp_contact_user_con_exclusion_motors_contact_per_user
      , pom_vis_xp_contact_user_con_exclusion_motors_user_logg_contact
      , pom_vis_xp_contact_user_con_exclusion_motors_user_not_logg_contact
      , SAFE_DIVIDE(pom_vis_xp_contact_user_con_exclusion_motors_user_logg_contact, ( COALESCE(pom_vis_xp_contact_user_con_exclusion_motors_user_logg_contact, 0) + COALESCE(pom_vis_xp_contact_user_con_exclusion_motors_user_not_logg_contact,0) ) ) AS perc_pom_vis_xp_contact_user_con_exclusion_motors_user_logg_contact
      , SAFE_DIVIDE(pom_vis_xp_contact_user_con_exclusion_motors_user_not_logg_contact, ( COALESCE(pom_vis_xp_contact_user_con_exclusion_motors_user_logg_contact, 0) + COALESCE(pom_vis_xp_contact_user_con_exclusion_motors_user_not_logg_contact,0) ) ) AS perc_pom_vis_xp_contact_user_con_exclusion_motors_user_not_logg_contact
      , pom_vis_xp_contact_user_con_exclusion_motors_item_contacted
      , SAFE_DIVIDE(pom_vis_xp_contact_user_con_exclusion_motors_timedecay_contact_attribution, pom_vis_xp_contact_user_con_exclusion_motors_item_contacted) AS avg_pom_vis_xp_contact_user_con_exclusion_motors_item_contacted
      , pom_vis_xp_contact_user_con_exclusion_motors_seller_contacted
      , SAFE_DIVIDE(pom_vis_xp_contact_user_con_exclusion_motors_timedecay_contact_attribution, pom_vis_xp_contact_user_con_exclusion_motors_seller_contacted) AS avg_pom_vis_xp_contact_user_con_exclusion_motors_seller_contacted

      -- touchpoints
      , pom_vis_xp_contact_user_con_exclusion_user_touch_point
      , pom_vis_xp_contact_user_con_exclusion_user_logg_touch_point
      , pom_vis_xp_contact_user_con_exclusion_user_not_logg_touch_point
      , SAFE_DIVIDE(pom_vis_xp_contact_user_con_exclusion_user_logg_touch_point, ( COALESCE(pom_vis_xp_contact_user_con_exclusion_user_logg_touch_point, 0) + COALESCE(pom_vis_xp_contact_user_con_exclusion_user_not_logg_touch_point, 0) ) ) AS perc_pom_vis_xp_contact_user_con_exclusion_user_logg_touch_point
      , SAFE_DIVIDE(pom_vis_xp_contact_user_con_exclusion_user_not_logg_touch_point, ( COALESCE(pom_vis_xp_contact_user_con_exclusion_user_logg_touch_point, 0) + COALESCE(pom_vis_xp_contact_user_con_exclusion_user_not_logg_touch_point, 0) ) ) AS perc_pom_vis_xp_contact_user_con_exclusion_user_not_logg_touch_point

      -- cost clicks impressions
      , pom_vis_xp_contact_user_con_exclusion_clicks
      , pom_vis_xp_contact_user_con_exclusion_impressions
      , pom_vis_xp_contact_user_con_exclusion_usd_cost
      , pom_vis_xp_contact_user_con_exclusion_lc_cost
      , SAFE_DIVIDE(pom_vis_xp_contact_user_con_exclusion_lc_cost, pom_vis_xp_contact_user_con_exclusion_clicks) AS pom_vis_xp_contact_user_con_exclusion_lc_cost_per_clicks
      , SAFE_DIVIDE(pom_vis_xp_contact_user_con_exclusion_lc_cost, pom_vis_xp_contact_user_con_exclusion_impressions) AS pom_vis_xp_contact_user_con_exclusion_lc_cost_per_impressions
      , SAFE_DIVIDE(pom_vis_xp_contact_user_con_exclusion_lc_cost, pom_vis_xp_contact_user_con_exclusion_user_touch_point) AS pom_vis_xp_contact_user_con_exclusion_lc_cost_per_user_touch_point
      , SAFE_DIVIDE(pom_vis_xp_contact_user_con_exclusion_lc_cost, pom_vis_xp_contact_user_con_exclusion_motors_timedecay_contact_attribution) AS pom_vis_xp_contact_user_con_exclusion_lc_cost_per_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_xp_contact_user_con_exclusion_lc_cost, pom_vis_xp_contact_user_con_exclusion_motors_user_contact) AS pom_vis_xp_contact_user_con_exclusion_lc_cost_per_user_contact
      , SAFE_DIVIDE(pom_vis_xp_contact_user_con_exclusion_lc_cost, pom_vis_xp_contact_user_con_exclusion_motors_item_contacted) AS pom_vis_xp_contact_user_con_exclusion_lc_cost_per_item_contacted
      , SAFE_DIVIDE(pom_vis_xp_contact_user_con_exclusion_lc_cost, pom_vis_xp_contact_user_con_exclusion_motors_seller_contacted) AS pom_vis_xp_contact_user_con_exclusion_lc_cost_per_seller_contacted

      , SAFE_DIVIDE(pom_vis_xp_contact_user_con_exclusion_usd_cost, pom_vis_xp_contact_user_con_exclusion_clicks) AS pom_vis_xp_contact_user_con_exclusion_usd_cost_per_clicks
      , SAFE_DIVIDE(pom_vis_xp_contact_user_con_exclusion_usd_cost, pom_vis_xp_contact_user_con_exclusion_impressions) AS pom_vis_xp_contact_user_con_exclusion_usd_cost_per_impressions
      , SAFE_DIVIDE(pom_vis_xp_contact_user_con_exclusion_usd_cost, pom_vis_xp_contact_user_con_exclusion_user_touch_point) AS pom_vis_xp_contact_user_con_exclusion_usd_cost_per_user_touch_point
      , SAFE_DIVIDE(pom_vis_xp_contact_user_con_exclusion_usd_cost, pom_vis_xp_contact_user_con_exclusion_motors_timedecay_contact_attribution) AS pom_vis_xp_contact_user_con_exclusion_usd_cost_per_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_xp_contact_user_con_exclusion_usd_cost, pom_vis_xp_contact_user_con_exclusion_motors_user_contact) AS pom_vis_xp_contact_user_con_exclusion_usd_cost_per_user_contact
      , SAFE_DIVIDE(pom_vis_xp_contact_user_con_exclusion_usd_cost, pom_vis_xp_contact_user_con_exclusion_motors_item_contacted) AS pom_vis_xp_contact_user_con_exclusion_usd_cost_per_item_contacted
      , SAFE_DIVIDE(pom_vis_xp_contact_user_con_exclusion_usd_cost, pom_vis_xp_contact_user_con_exclusion_motors_seller_contacted) AS pom_vis_xp_contact_user_con_exclusion_usd_cost_per_seller_contacted

   ------------------------
    -- XP: contactos SIN exclusion
    ------------------------
      -- leads
      , pom_vis_xp_contact_user_sin_exclusion_motors_timedecay_contact_attribution
      , pom_vis_xp_contact_user_sin_exclusion_motors_user_contact
      , SAFE_DIVIDE(pom_vis_xp_contact_user_sin_exclusion_motors_timedecay_contact_attribution, pom_vis_xp_contact_user_sin_exclusion_motors_user_contact) AS avg_pom_vis_xp_contact_user_sin_exclusion_motors_contact_per_user
      , pom_vis_xp_contact_user_sin_exclusion_motors_user_logg_contact
      , pom_vis_xp_contact_user_sin_exclusion_motors_user_not_logg_contact
      , SAFE_DIVIDE(pom_vis_xp_contact_user_sin_exclusion_motors_user_logg_contact, ( COALESCE(pom_vis_xp_contact_user_sin_exclusion_motors_user_logg_contact, 0) + COALESCE(pom_vis_xp_contact_user_sin_exclusion_motors_user_not_logg_contact,0) ) ) AS perc_pom_vis_xp_contact_user_sin_exclusion_motors_user_logg_contact
      , SAFE_DIVIDE(pom_vis_xp_contact_user_sin_exclusion_motors_user_not_logg_contact, ( COALESCE(pom_vis_xp_contact_user_sin_exclusion_motors_user_logg_contact, 0) + COALESCE(pom_vis_xp_contact_user_sin_exclusion_motors_user_not_logg_contact,0) ) ) AS perc_pom_vis_xp_contact_user_sin_exclusion_motors_user_not_logg_contact
      , pom_vis_xp_contact_user_sin_exclusion_motors_item_contacted
      , SAFE_DIVIDE(pom_vis_xp_contact_user_sin_exclusion_motors_timedecay_contact_attribution, pom_vis_xp_contact_user_sin_exclusion_motors_item_contacted) AS avg_pom_vis_xp_contact_user_sin_exclusion_motors_item_contacted
      , pom_vis_xp_contact_user_sin_exclusion_motors_seller_contacted
      , SAFE_DIVIDE(pom_vis_xp_contact_user_sin_exclusion_motors_timedecay_contact_attribution, pom_vis_xp_contact_user_sin_exclusion_motors_seller_contacted) AS avg_pom_vis_xp_contact_user_sin_exclusion_motors_seller_contacted

      -- touchpoints
      , pom_vis_xp_contact_user_sin_exclusion_user_touch_point
      , pom_vis_xp_contact_user_sin_exclusion_user_logg_touch_point
      , pom_vis_xp_contact_user_sin_exclusion_user_not_logg_touch_point
      , SAFE_DIVIDE(pom_vis_xp_contact_user_sin_exclusion_user_logg_touch_point, ( COALESCE(pom_vis_xp_contact_user_sin_exclusion_user_logg_touch_point, 0) + COALESCE(pom_vis_xp_contact_user_sin_exclusion_user_not_logg_touch_point, 0) ) ) AS perc_pom_vis_xp_contact_user_sin_exclusion_user_logg_touch_point
      , SAFE_DIVIDE(pom_vis_xp_contact_user_sin_exclusion_user_not_logg_touch_point, ( COALESCE(pom_vis_xp_contact_user_sin_exclusion_user_logg_touch_point, 0) + COALESCE(pom_vis_xp_contact_user_sin_exclusion_user_not_logg_touch_point, 0) ) ) AS perc_pom_vis_xp_contact_user_sin_exclusion_user_not_logg_touch_point

      -- cost clicks impressions
      , pom_vis_xp_contact_user_sin_exclusion_clicks
      , pom_vis_xp_contact_user_sin_exclusion_impressions
      , pom_vis_xp_contact_user_sin_exclusion_usd_cost
      , pom_vis_xp_contact_user_sin_exclusion_lc_cost
      , SAFE_DIVIDE(pom_vis_xp_contact_user_sin_exclusion_lc_cost, pom_vis_xp_contact_user_sin_exclusion_clicks) AS pom_vis_xp_contact_user_sin_exclusion_lc_cost_per_clicks
      , SAFE_DIVIDE(pom_vis_xp_contact_user_sin_exclusion_lc_cost, pom_vis_xp_contact_user_sin_exclusion_impressions) AS pom_vis_xp_contact_user_sin_exclusion_lc_cost_per_impressions
      , SAFE_DIVIDE(pom_vis_xp_contact_user_sin_exclusion_lc_cost, pom_vis_xp_contact_user_sin_exclusion_user_touch_point) AS pom_vis_xp_contact_user_sin_exclusion_lc_cost_per_user_touch_point
      , SAFE_DIVIDE(pom_vis_xp_contact_user_sin_exclusion_lc_cost, pom_vis_xp_contact_user_sin_exclusion_motors_timedecay_contact_attribution) AS pom_vis_xp_contact_user_sin_exclusion_lc_cost_per_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_xp_contact_user_sin_exclusion_lc_cost, pom_vis_xp_contact_user_sin_exclusion_motors_user_contact) AS pom_vis_xp_contact_user_sin_exclusion_lc_cost_per_user_contact
      , SAFE_DIVIDE(pom_vis_xp_contact_user_sin_exclusion_lc_cost, pom_vis_xp_contact_user_sin_exclusion_motors_item_contacted) AS pom_vis_xp_contact_user_sin_exclusion_lc_cost_per_item_contacted
      , SAFE_DIVIDE(pom_vis_xp_contact_user_sin_exclusion_lc_cost, pom_vis_xp_contact_user_sin_exclusion_motors_seller_contacted) AS pom_vis_xp_contact_user_sin_exclusion_lc_cost_per_seller_contacted

      , SAFE_DIVIDE(pom_vis_xp_contact_user_sin_exclusion_usd_cost, pom_vis_xp_contact_user_sin_exclusion_clicks) AS pom_vis_xp_contact_user_sin_exclusion_usd_cost_per_clicks
      , SAFE_DIVIDE(pom_vis_xp_contact_user_sin_exclusion_usd_cost, pom_vis_xp_contact_user_sin_exclusion_impressions) AS pom_vis_xp_contact_user_sin_exclusion_usd_cost_per_impressions
      , SAFE_DIVIDE(pom_vis_xp_contact_user_sin_exclusion_usd_cost, pom_vis_xp_contact_user_sin_exclusion_user_touch_point) AS pom_vis_xp_contact_user_sin_exclusion_usd_cost_per_user_touch_point
      , SAFE_DIVIDE(pom_vis_xp_contact_user_sin_exclusion_usd_cost, pom_vis_xp_contact_user_sin_exclusion_motors_timedecay_contact_attribution) AS pom_vis_xp_contact_user_sin_exclusion_usd_cost_per_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_xp_contact_user_sin_exclusion_usd_cost, pom_vis_xp_contact_user_sin_exclusion_motors_user_contact) AS pom_vis_xp_contact_user_sin_exclusion_usd_cost_per_user_contact
      , SAFE_DIVIDE(pom_vis_xp_contact_user_sin_exclusion_usd_cost, pom_vis_xp_contact_user_sin_exclusion_motors_item_contacted) AS pom_vis_xp_contact_user_sin_exclusion_usd_cost_per_item_contacted
      , SAFE_DIVIDE(pom_vis_xp_contact_user_sin_exclusion_usd_cost, pom_vis_xp_contact_user_sin_exclusion_motors_seller_contacted) AS pom_vis_xp_contact_user_sin_exclusion_usd_cost_per_seller_contacted

  ------------------------------------------------
  ---- Autos y camionetas
  ------------------------------------------------

    ------------------------
    -- TOTAL (sin apertura de canal)
    ------------------------
      -- leads
      , total_ayc_contact
      , SAFE_DIVIDE(pom_vis_ayc_timedecay_contact_attribution, total_ayc_contact) AS perc_pom_vis_ayc_timedecay_contact_attribution
      , SAFE_DIVIDE(direct_ayc_timedecay_contact_attribution, total_ayc_contact) AS perc_direct_ayc_timedecay_contact_attribution
      , SAFE_DIVIDE(seo_ayc_timedecay_contact_attribution, total_ayc_contact) AS perc_seo_ayc_timedecay_contact_attribution
      , SAFE_DIVIDE(own_channels_ayc_timedecay_contact_attribution, total_ayc_contact) AS perc_own_channels_ayc_timedecay_contact_attribution
      , SAFE_DIVIDE(matt_other_ayc_timedecay_contact_attribution, total_ayc_contact) AS perc_matt_other_ayc_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_desvio_ayc_timedecay_contact_attribution, total_ayc_contact) AS perc_pom_vis_desvio_ayc_timedecay_contact_attribution

      , total_ayc_user_contact
      , SAFE_DIVIDE(pom_vis_ayc_user_contact ,(COALESCE(pom_vis_ayc_user_contact, 0) + COALESCE(direct_ayc_user_contact, 0) + COALESCE(seo_ayc_user_contact, 0) + COALESCE(own_channels_ayc_user_contact, 0) + COALESCE(matt_other_ayc_user_contact, 0) + COALESCE(pom_vis_desvio_ayc_user_contact, 0) ) ) perc_pom_vis_ayc_user_contact

      , SAFE_DIVIDE(direct_ayc_user_contact ,(COALESCE(pom_vis_ayc_user_contact, 0) + COALESCE(direct_ayc_user_contact, 0) + COALESCE(seo_ayc_user_contact, 0) + COALESCE(own_channels_ayc_user_contact, 0) + COALESCE(matt_other_ayc_user_contact, 0) + COALESCE(pom_vis_desvio_ayc_user_contact, 0) ) ) perc_direct_ayc_user_contact

      , SAFE_DIVIDE(seo_ayc_user_contact ,(COALESCE(pom_vis_ayc_user_contact, 0) + COALESCE(direct_ayc_user_contact, 0) + COALESCE(seo_ayc_user_contact, 0) + COALESCE(own_channels_ayc_user_contact, 0) + COALESCE(matt_other_ayc_user_contact, 0) + COALESCE(pom_vis_desvio_ayc_user_contact, 0) ) ) perc_seo_ayc_user_contact

      , SAFE_DIVIDE(own_channels_ayc_user_contact ,(COALESCE(pom_vis_ayc_user_contact, 0) + COALESCE(direct_ayc_user_contact, 0) + COALESCE(seo_ayc_user_contact, 0) + COALESCE(own_channels_ayc_user_contact, 0) + COALESCE(matt_other_ayc_user_contact, 0) + COALESCE(pom_vis_desvio_ayc_user_contact, 0) ) ) perc_own_channels_ayc_user_contact

      , SAFE_DIVIDE(matt_other_ayc_user_contact ,(COALESCE(pom_vis_ayc_user_contact, 0) + COALESCE(direct_ayc_user_contact, 0) + COALESCE(seo_ayc_user_contact, 0) + COALESCE(own_channels_ayc_user_contact, 0) + COALESCE(matt_other_ayc_user_contact, 0) + COALESCE(pom_vis_desvio_ayc_user_contact, 0) ) ) perc_matt_other_ayc_user_contact

      , SAFE_DIVIDE(pom_vis_desvio_ayc_user_contact ,(COALESCE(pom_vis_ayc_user_contact, 0) + COALESCE(direct_ayc_user_contact, 0) + COALESCE(seo_ayc_user_contact, 0) + COALESCE(own_channels_ayc_user_contact, 0) + COALESCE(matt_other_ayc_user_contact, 0) + COALESCE(pom_vis_desvio_ayc_user_contact, 0) ) ) perc_pom_vis_desvio_ayc_user_contact



      , SAFE_DIVIDE(total_ayc_contact, total_ayc_user_contact) AS avg_ayc_contact_per_user
      , total_ayc_user_logg_contact
      , total_ayc_user_not_logg_contact
      , SAFE_DIVIDE(total_ayc_user_logg_contact, ( COALESCE(total_ayc_user_logg_contact, 0) + COALESCE(total_ayc_user_not_logg_contact, 0) ) ) AS perc_total_ayc_user_logg_contact
      , SAFE_DIVIDE(total_ayc_user_not_logg_contact, ( COALESCE(total_ayc_user_logg_contact, 0) + COALESCE(total_ayc_user_not_logg_contact, 0) ) ) AS perc_total_ayc_user_not_logg_contact
      , total_ayc_item_contacted
      , SAFE_DIVIDE(total_ayc_contact, total_ayc_item_contacted) AS avg_total_ayc_item_contacted
      , total_ayc_seller_contacted
      , SAFE_DIVIDE(total_ayc_contact, total_ayc_seller_contacted) AS avg_total_ayc_seller_contacted


   ------------------------
    -- POM VIS TOTAL
    ------------------------
      -- leads
      , pom_vis_ayc_timedecay_contact_attribution
      , pom_vis_ayc_user_contact
      , SAFE_DIVIDE(pom_vis_ayc_timedecay_contact_attribution, pom_vis_ayc_user_contact) AS avg_pom_vis_ayc_contact_per_user
      , pom_vis_ayc_user_logg_contact
      , pom_vis_ayc_user_not_logg_contact
      , SAFE_DIVIDE(pom_vis_ayc_user_logg_contact, ( COALESCE(pom_vis_ayc_user_logg_contact, 0) + COALESCE(pom_vis_ayc_user_not_logg_contact,0) ) ) AS perc_pom_vis_ayc_user_logg_contact
      , SAFE_DIVIDE(pom_vis_ayc_user_not_logg_contact, ( COALESCE(pom_vis_ayc_user_logg_contact, 0) + COALESCE(pom_vis_ayc_user_not_logg_contact,0) ) ) AS perc_pom_vis_ayc_user_not_logg_contact
      , pom_vis_ayc_item_contacted
      , SAFE_DIVIDE(pom_vis_ayc_timedecay_contact_attribution, pom_vis_ayc_item_contacted) AS avg_pom_vis_ayc_item_contacted
      , pom_vis_ayc_seller_contacted
      , SAFE_DIVIDE(pom_vis_ayc_timedecay_contact_attribution, pom_vis_ayc_seller_contacted) AS avg_pom_vis_ayc_seller_contacted


      -- cost clicks impressions
      , SAFE_DIVIDE(pom_vis_lc_cost, pom_vis_ayc_timedecay_contact_attribution) AS pom_vis_ayc_lc_cost_per_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_lc_cost, pom_vis_ayc_user_contact) AS pom_vis_ayc_lc_cost_per_user_contact
      , SAFE_DIVIDE(pom_vis_lc_cost, pom_vis_ayc_item_contacted) AS pom_vis_ayc_lc_cost_per_item_contacted
      , SAFE_DIVIDE(pom_vis_lc_cost, pom_vis_ayc_seller_contacted) AS pom_vis_ayc_lc_cost_per_seller_contacted

      , SAFE_DIVIDE(pom_vis_usd_cost, pom_vis_ayc_timedecay_contact_attribution) AS pom_vis_ayc_usd_cost_per_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_usd_cost, pom_vis_ayc_user_contact) AS pom_vis_ayc_usd_cost_per_user_contact
      , SAFE_DIVIDE(pom_vis_usd_cost, pom_vis_ayc_item_contacted) AS pom_vis_ayc_usd_cost_per_item_contacted
      , SAFE_DIVIDE(pom_vis_usd_cost, pom_vis_ayc_seller_contacted) AS pom_vis_ayc_usd_cost_per_seller_contacted


   ------------------------
    -- DIRECT
    ------------------------
      -- leads
      , direct_ayc_timedecay_contact_attribution
      , direct_ayc_user_contact
      , SAFE_DIVIDE(direct_ayc_timedecay_contact_attribution, direct_ayc_user_contact) AS avg_direct_ayc_contact_per_user
      , direct_ayc_user_logg_contact
      , direct_ayc_user_not_logg_contact
      , SAFE_DIVIDE(direct_ayc_user_logg_contact, ( COALESCE(direct_ayc_user_logg_contact, 0) + COALESCE(direct_ayc_user_not_logg_contact,0) ) ) AS perc_direct_ayc_user_logg_contact
      , SAFE_DIVIDE(direct_ayc_user_not_logg_contact, ( COALESCE(direct_ayc_user_logg_contact, 0) + COALESCE(direct_ayc_user_not_logg_contact,0) ) ) AS perc_direct_ayc_user_not_logg_contact
      , direct_ayc_item_contacted
      , SAFE_DIVIDE(direct_ayc_timedecay_contact_attribution, direct_ayc_item_contacted) AS avg_direct_ayc_item_contacted
      , direct_ayc_seller_contacted
      , SAFE_DIVIDE(direct_ayc_timedecay_contact_attribution, direct_ayc_seller_contacted) AS avg_direct_ayc_seller_contacted


   ------------------------
    -- SEO
    ------------------------
      -- leads
      , seo_ayc_timedecay_contact_attribution
      , seo_ayc_user_contact
      , SAFE_DIVIDE(seo_ayc_timedecay_contact_attribution, seo_ayc_user_contact) AS avg_seo_ayc_contact_per_user
      , seo_ayc_user_logg_contact
      , seo_ayc_user_not_logg_contact
      , SAFE_DIVIDE(seo_ayc_user_logg_contact, ( COALESCE(seo_ayc_user_logg_contact, 0) + COALESCE(seo_ayc_user_not_logg_contact,0) ) ) AS perc_seo_ayc_user_logg_contact
      , SAFE_DIVIDE(seo_ayc_user_not_logg_contact, ( COALESCE(seo_ayc_user_logg_contact, 0) + COALESCE(seo_ayc_user_not_logg_contact,0) ) ) AS perc_seo_ayc_user_not_logg_contact
      , seo_ayc_item_contacted
      , SAFE_DIVIDE(seo_ayc_timedecay_contact_attribution, seo_ayc_item_contacted) AS avg_seo_ayc_item_contacted
      , seo_ayc_seller_contacted
      , SAFE_DIVIDE(seo_ayc_timedecay_contact_attribution, seo_ayc_seller_contacted) AS avg_seo_ayc_seller_contacted

   ------------------------
    -- OWN CHANNELS
    ------------------------
      -- leads
      , own_channels_ayc_timedecay_contact_attribution
      , own_channels_ayc_user_contact
      , SAFE_DIVIDE(own_channels_ayc_timedecay_contact_attribution, own_channels_ayc_user_contact) AS avg_own_channels_ayc_contact_per_user
      , own_channels_ayc_user_logg_contact
      , own_channels_ayc_user_not_logg_contact
      , SAFE_DIVIDE(own_channels_ayc_user_logg_contact, ( COALESCE(own_channels_ayc_user_logg_contact, 0) + COALESCE(own_channels_ayc_user_not_logg_contact,0) ) ) AS perc_own_channels_ayc_user_logg_contact
      , SAFE_DIVIDE(own_channels_ayc_user_not_logg_contact, ( COALESCE(own_channels_ayc_user_logg_contact, 0) + COALESCE(own_channels_ayc_user_not_logg_contact,0) ) ) AS perc_own_channels_ayc_user_not_logg_contact
      , own_channels_ayc_item_contacted
      , SAFE_DIVIDE(own_channels_ayc_timedecay_contact_attribution, own_channels_ayc_item_contacted) AS avg_own_channels_ayc_item_contacted
      , own_channels_ayc_seller_contacted
      , SAFE_DIVIDE(own_channels_ayc_timedecay_contact_attribution, own_channels_ayc_seller_contacted) AS avg_own_channels_ayc_seller_contacted

   ------------------------
    -- MATT OTHER
    ------------------------
      -- leads
      , matt_other_ayc_timedecay_contact_attribution
      , matt_other_ayc_user_contact
      , SAFE_DIVIDE(matt_other_ayc_timedecay_contact_attribution, matt_other_ayc_user_contact) AS avg_matt_other_ayc_contact_per_user
      , matt_other_ayc_user_logg_contact
      , matt_other_ayc_user_not_logg_contact
      , SAFE_DIVIDE(matt_other_ayc_user_logg_contact, ( COALESCE(matt_other_ayc_user_logg_contact, 0) + COALESCE(matt_other_ayc_user_not_logg_contact,0) ) ) AS perc_matt_other_ayc_user_logg_contact
      , SAFE_DIVIDE(matt_other_ayc_user_not_logg_contact, ( COALESCE(matt_other_ayc_user_logg_contact, 0) + COALESCE(matt_other_ayc_user_not_logg_contact,0) ) ) AS perc_matt_other_ayc_user_not_logg_contact
      , matt_other_ayc_item_contacted
      , SAFE_DIVIDE(matt_other_ayc_timedecay_contact_attribution, matt_other_ayc_item_contacted) AS avg_matt_other_ayc_item_contacted
      , matt_other_ayc_seller_contacted
      , SAFE_DIVIDE(matt_other_ayc_timedecay_contact_attribution, matt_other_ayc_seller_contacted) AS avg_matt_other_ayc_seller_contacted

   ------------------------
    -- POM VIS DESVIO
    ------------------------
      -- leads
      , pom_vis_desvio_ayc_timedecay_contact_attribution
      , pom_vis_desvio_ayc_user_contact
      , SAFE_DIVIDE(pom_vis_desvio_ayc_timedecay_contact_attribution, pom_vis_desvio_ayc_user_contact) AS avg_pom_vis_desvio_ayc_contact_per_user
      , pom_vis_desvio_ayc_user_logg_contact
      , pom_vis_desvio_ayc_user_not_logg_contact
      , SAFE_DIVIDE(pom_vis_desvio_ayc_user_logg_contact, ( COALESCE(pom_vis_desvio_ayc_user_logg_contact, 0) + COALESCE(pom_vis_desvio_ayc_user_not_logg_contact,0) ) ) AS perc_pom_vis_desvio_ayc_user_logg_contact
      , SAFE_DIVIDE(pom_vis_desvio_ayc_user_not_logg_contact, ( COALESCE(pom_vis_desvio_ayc_user_logg_contact, 0) + COALESCE(pom_vis_desvio_ayc_user_not_logg_contact,0) ) ) AS perc_pom_vis_desvio_ayc_user_not_logg_contact
      , pom_vis_desvio_ayc_item_contacted
      , SAFE_DIVIDE(pom_vis_desvio_ayc_timedecay_contact_attribution, pom_vis_desvio_ayc_item_contacted) AS avg_pom_vis_desvio_ayc_item_contacted
      , pom_vis_desvio_ayc_seller_contacted
      , SAFE_DIVIDE(pom_vis_desvio_ayc_timedecay_contact_attribution, pom_vis_desvio_ayc_seller_contacted) AS avg_pom_vis_desvio_ayc_seller_contacted


   ------------------------
    -- GOOGLE SEARCH (POM VIS)
    ------------------------
      -- leads
      , pom_vis_google_search_ayc_timedecay_contact_attribution
      , pom_vis_google_search_ayc_user_contact
      , SAFE_DIVIDE(pom_vis_google_search_ayc_timedecay_contact_attribution, pom_vis_google_search_ayc_user_contact) AS avg_pom_vis_google_search_ayc_contact_per_user
      , pom_vis_google_search_ayc_user_logg_contact
      , pom_vis_google_search_ayc_user_not_logg_contact
      , SAFE_DIVIDE(pom_vis_google_search_ayc_user_logg_contact, ( COALESCE(pom_vis_google_search_ayc_user_logg_contact, 0) + COALESCE(pom_vis_google_search_ayc_user_not_logg_contact,0) ) ) AS perc_pom_vis_google_search_ayc_user_logg_contact
      , SAFE_DIVIDE(pom_vis_google_search_ayc_user_not_logg_contact, ( COALESCE(pom_vis_google_search_ayc_user_logg_contact, 0) + COALESCE(pom_vis_google_search_ayc_user_not_logg_contact,0) ) ) AS perc_pom_vis_google_search_ayc_user_not_logg_contact
      , pom_vis_google_search_ayc_item_contacted
      , SAFE_DIVIDE(pom_vis_google_search_ayc_timedecay_contact_attribution, pom_vis_google_search_ayc_item_contacted) AS avg_pom_vis_google_search_ayc_item_contacted
      , pom_vis_google_search_ayc_seller_contacted
      , SAFE_DIVIDE(pom_vis_google_search_ayc_timedecay_contact_attribution, pom_vis_google_search_ayc_seller_contacted) AS avg_pom_vis_google_search_ayc_seller_contacted


      -- cost clicks impressions
      , SAFE_DIVIDE(pom_vis_google_search_lc_cost, pom_vis_google_search_ayc_timedecay_contact_attribution) AS pom_vis_google_search_ayc_lc_cost_per_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_google_search_lc_cost, pom_vis_google_search_ayc_user_contact) AS pom_vis_google_search_ayc_lc_cost_per_user_contact
      , SAFE_DIVIDE(pom_vis_google_search_lc_cost, pom_vis_google_search_ayc_item_contacted) AS pom_vis_google_search_ayc_lc_cost_per_item_contacted
      , SAFE_DIVIDE(pom_vis_google_search_lc_cost, pom_vis_google_search_ayc_seller_contacted) AS pom_vis_google_search_ayc_lc_cost_per_seller_contacted

      , SAFE_DIVIDE(pom_vis_google_search_usd_cost, pom_vis_google_search_ayc_timedecay_contact_attribution) AS pom_vis_google_search_ayc_usd_cost_per_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_google_search_usd_cost, pom_vis_google_search_ayc_user_contact) AS pom_vis_google_search_ayc_usd_cost_per_user_contact
      , SAFE_DIVIDE(pom_vis_google_search_usd_cost, pom_vis_google_search_ayc_item_contacted) AS pom_vis_google_search_ayc_usd_cost_per_item_contacted
      , SAFE_DIVIDE(pom_vis_google_search_usd_cost, pom_vis_google_search_ayc_seller_contacted) AS pom_vis_google_search_ayc_usd_cost_per_seller_contacted


   ------------------------
    -- GOOGLE DISPLAY (POM VIS)
    ------------------------
      -- leads
      , pom_vis_google_display_ayc_timedecay_contact_attribution
      , pom_vis_google_display_ayc_user_contact
      , SAFE_DIVIDE(pom_vis_google_display_ayc_timedecay_contact_attribution, pom_vis_google_display_ayc_user_contact) AS avg_pom_vis_google_display_ayc_contact_per_user
      , pom_vis_google_display_ayc_user_logg_contact
      , pom_vis_google_display_ayc_user_not_logg_contact
      , SAFE_DIVIDE(pom_vis_google_display_ayc_user_logg_contact, ( COALESCE(pom_vis_google_display_ayc_user_logg_contact, 0) + COALESCE(pom_vis_google_display_ayc_user_not_logg_contact,0) ) ) AS perc_pom_vis_google_display_ayc_user_logg_contact
      , SAFE_DIVIDE(pom_vis_google_display_ayc_user_not_logg_contact, ( COALESCE(pom_vis_google_display_ayc_user_logg_contact, 0) + COALESCE(pom_vis_google_display_ayc_user_not_logg_contact,0) ) ) AS perc_pom_vis_google_display_ayc_user_not_logg_contact
      , pom_vis_google_display_ayc_item_contacted
      , SAFE_DIVIDE(pom_vis_google_display_ayc_timedecay_contact_attribution, pom_vis_google_display_ayc_item_contacted) AS avg_pom_vis_google_display_ayc_item_contacted
      , pom_vis_google_display_ayc_seller_contacted
      , SAFE_DIVIDE(pom_vis_google_display_ayc_timedecay_contact_attribution, pom_vis_google_display_ayc_seller_contacted) AS avg_pom_vis_google_display_ayc_seller_contacted


      -- cost clicks impressions
      , SAFE_DIVIDE(pom_vis_google_display_lc_cost, pom_vis_google_display_ayc_timedecay_contact_attribution) AS pom_vis_google_display_ayc_lc_cost_per_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_google_display_lc_cost, pom_vis_google_display_ayc_user_contact) AS pom_vis_google_display_ayc_lc_cost_per_user_contact
      , SAFE_DIVIDE(pom_vis_google_display_lc_cost, pom_vis_google_display_ayc_item_contacted) AS pom_vis_google_display_ayc_lc_cost_per_item_contacted
      , SAFE_DIVIDE(pom_vis_google_display_lc_cost, pom_vis_google_display_ayc_seller_contacted) AS pom_vis_google_display_ayc_lc_cost_per_seller_contacted

      , SAFE_DIVIDE(pom_vis_google_display_usd_cost, pom_vis_google_display_ayc_timedecay_contact_attribution) AS pom_vis_google_display_ayc_usd_cost_per_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_google_display_usd_cost, pom_vis_google_display_ayc_user_contact) AS pom_vis_google_display_ayc_usd_cost_per_user_contact
      , SAFE_DIVIDE(pom_vis_google_display_usd_cost, pom_vis_google_display_ayc_item_contacted) AS pom_vis_google_display_ayc_usd_cost_per_item_contacted
      , SAFE_DIVIDE(pom_vis_google_display_usd_cost, pom_vis_google_display_ayc_seller_contacted) AS pom_vis_google_display_ayc_usd_cost_per_seller_contacted


   ------------------------
    -- FACEBOOK (POM VIS)
    ------------------------
      -- leads
      , pom_vis_facebook_ayc_timedecay_contact_attribution
      , pom_vis_facebook_ayc_user_contact
      , SAFE_DIVIDE(pom_vis_facebook_ayc_timedecay_contact_attribution, pom_vis_facebook_ayc_user_contact) AS avg_pom_vis_facebook_ayc_contact_per_user
      , pom_vis_facebook_ayc_user_logg_contact
      , pom_vis_facebook_ayc_user_not_logg_contact
      , SAFE_DIVIDE(pom_vis_facebook_ayc_user_logg_contact, ( COALESCE(pom_vis_facebook_ayc_user_logg_contact, 0) + COALESCE(pom_vis_facebook_ayc_user_not_logg_contact,0) ) ) AS perc_pom_vis_facebook_ayc_user_logg_contact
      , SAFE_DIVIDE(pom_vis_facebook_ayc_user_not_logg_contact, ( COALESCE(pom_vis_facebook_ayc_user_logg_contact, 0) + COALESCE(pom_vis_facebook_ayc_user_not_logg_contact,0) ) ) AS perc_pom_vis_facebook_ayc_user_not_logg_contact
      , pom_vis_facebook_ayc_item_contacted
      , SAFE_DIVIDE(pom_vis_facebook_ayc_timedecay_contact_attribution, pom_vis_facebook_ayc_item_contacted) AS avg_pom_vis_facebook_ayc_item_contacted
      , pom_vis_facebook_ayc_seller_contacted
      , SAFE_DIVIDE(pom_vis_facebook_ayc_timedecay_contact_attribution, pom_vis_facebook_ayc_seller_contacted) AS avg_pom_vis_facebook_ayc_seller_contacted


      -- cost clicks impressions
      , SAFE_DIVIDE(pom_vis_facebook_lc_cost, pom_vis_facebook_ayc_timedecay_contact_attribution) AS pom_vis_facebook_ayc_lc_cost_per_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_facebook_lc_cost, pom_vis_facebook_ayc_user_contact) AS pom_vis_facebook_ayc_lc_cost_per_user_contact
      , SAFE_DIVIDE(pom_vis_facebook_lc_cost, pom_vis_facebook_ayc_item_contacted) AS pom_vis_facebook_ayc_lc_cost_per_item_contacted
      , SAFE_DIVIDE(pom_vis_facebook_lc_cost, pom_vis_facebook_ayc_seller_contacted) AS pom_vis_facebook_ayc_lc_cost_per_seller_contacted

      , SAFE_DIVIDE(pom_vis_facebook_usd_cost, pom_vis_facebook_ayc_timedecay_contact_attribution) AS pom_vis_facebook_ayc_usd_cost_per_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_facebook_usd_cost, pom_vis_facebook_ayc_user_contact) AS pom_vis_facebook_ayc_usd_cost_per_user_contact
      , SAFE_DIVIDE(pom_vis_facebook_usd_cost, pom_vis_facebook_ayc_item_contacted) AS pom_vis_facebook_ayc_usd_cost_per_item_contacted
      , SAFE_DIVIDE(pom_vis_facebook_usd_cost, pom_vis_facebook_ayc_seller_contacted) AS pom_vis_facebook_ayc_usd_cost_per_seller_contacted

   ------------------------
    -- FACEBOOK (POM VIS)
    ------------------------
      -- leads
      , pom_vis_facebook_forms_ayc_timedecay_contact_attribution
      , pom_vis_facebook_forms_ayc_user_contact
      , SAFE_DIVIDE(pom_vis_facebook_forms_ayc_timedecay_contact_attribution, pom_vis_facebook_forms_ayc_user_contact) AS avg_pom_vis_facebook_forms_ayc_contact_per_user
      , pom_vis_facebook_forms_ayc_user_logg_contact
      , pom_vis_facebook_forms_ayc_user_not_logg_contact
      , SAFE_DIVIDE(pom_vis_facebook_forms_ayc_user_logg_contact, ( COALESCE(pom_vis_facebook_forms_ayc_user_logg_contact, 0) + COALESCE(pom_vis_facebook_forms_ayc_user_not_logg_contact,0) ) ) AS perc_pom_vis_facebook_forms_ayc_user_logg_contact
      , SAFE_DIVIDE(pom_vis_facebook_forms_ayc_user_not_logg_contact, ( COALESCE(pom_vis_facebook_forms_ayc_user_logg_contact, 0) + COALESCE(pom_vis_facebook_forms_ayc_user_not_logg_contact,0) ) ) AS perc_pom_vis_facebook_forms_ayc_user_not_logg_contact
      , pom_vis_facebook_forms_ayc_item_contacted
      , SAFE_DIVIDE(pom_vis_facebook_forms_ayc_timedecay_contact_attribution, pom_vis_facebook_forms_ayc_item_contacted) AS avg_pom_vis_facebook_forms_ayc_item_contacted
      , pom_vis_facebook_forms_ayc_seller_contacted
      , SAFE_DIVIDE(pom_vis_facebook_forms_ayc_timedecay_contact_attribution, pom_vis_facebook_forms_ayc_seller_contacted) AS avg_pom_vis_facebook_forms_ayc_seller_contacted


      -- cost clicks impressions
      , SAFE_DIVIDE(pom_vis_facebook_forms_lc_cost, pom_vis_facebook_forms_ayc_timedecay_contact_attribution) AS pom_vis_facebook_forms_ayc_lc_cost_per_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_facebook_forms_lc_cost, pom_vis_facebook_forms_ayc_user_contact) AS pom_vis_facebook_forms_ayc_lc_cost_per_user_contact
      , SAFE_DIVIDE(pom_vis_facebook_forms_lc_cost, pom_vis_facebook_forms_ayc_item_contacted) AS pom_vis_facebook_forms_ayc_lc_cost_per_item_contacted
      , SAFE_DIVIDE(pom_vis_facebook_forms_lc_cost, pom_vis_facebook_forms_ayc_seller_contacted) AS pom_vis_facebook_forms_ayc_lc_cost_per_seller_contacted

      , SAFE_DIVIDE(pom_vis_facebook_forms_usd_cost, pom_vis_facebook_forms_ayc_timedecay_contact_attribution) AS pom_vis_facebook_forms_ayc_usd_cost_per_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_facebook_forms_usd_cost, pom_vis_facebook_forms_ayc_user_contact) AS pom_vis_facebook_forms_ayc_usd_cost_per_user_contact
      , SAFE_DIVIDE(pom_vis_facebook_forms_usd_cost, pom_vis_facebook_forms_ayc_item_contacted) AS pom_vis_facebook_forms_ayc_usd_cost_per_item_contacted
      , SAFE_DIVIDE(pom_vis_facebook_forms_usd_cost, pom_vis_facebook_forms_ayc_seller_contacted) AS pom_vis_facebook_forms_ayc_usd_cost_per_seller_contacted

   ------------------------
    -- RTB (POM VIS)
    ------------------------
      -- leads
      , pom_vis_rtb_ayc_timedecay_contact_attribution
      , pom_vis_rtb_ayc_user_contact
      , SAFE_DIVIDE(pom_vis_rtb_ayc_timedecay_contact_attribution, pom_vis_rtb_ayc_user_contact) AS avg_pom_vis_rtb_ayc_contact_per_user
      , pom_vis_rtb_ayc_user_logg_contact
      , pom_vis_rtb_ayc_user_not_logg_contact
      , SAFE_DIVIDE(pom_vis_rtb_ayc_user_logg_contact, ( COALESCE(pom_vis_rtb_ayc_user_logg_contact, 0) + COALESCE(pom_vis_rtb_ayc_user_not_logg_contact,0) ) ) AS perc_pom_vis_rtb_ayc_user_logg_contact
      , SAFE_DIVIDE(pom_vis_rtb_ayc_user_not_logg_contact, ( COALESCE(pom_vis_rtb_ayc_user_logg_contact, 0) + COALESCE(pom_vis_rtb_ayc_user_not_logg_contact,0) ) ) AS perc_pom_vis_rtb_ayc_user_not_logg_contact
      , pom_vis_rtb_ayc_item_contacted
      , SAFE_DIVIDE(pom_vis_rtb_ayc_timedecay_contact_attribution, pom_vis_rtb_ayc_item_contacted) AS avg_pom_vis_rtb_ayc_item_contacted
      , pom_vis_rtb_ayc_seller_contacted
      , SAFE_DIVIDE(pom_vis_rtb_ayc_timedecay_contact_attribution, pom_vis_rtb_ayc_seller_contacted) AS avg_pom_vis_rtb_ayc_seller_contacted


      -- cost clicks impressions
      , SAFE_DIVIDE(pom_vis_rtb_lc_cost, pom_vis_rtb_ayc_timedecay_contact_attribution) AS pom_vis_rtb_ayc_lc_cost_per_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_rtb_lc_cost, pom_vis_rtb_ayc_user_contact) AS pom_vis_rtb_ayc_lc_cost_per_user_contact
      , SAFE_DIVIDE(pom_vis_rtb_lc_cost, pom_vis_rtb_ayc_item_contacted) AS pom_vis_rtb_ayc_lc_cost_per_item_contacted
      , SAFE_DIVIDE(pom_vis_rtb_lc_cost, pom_vis_rtb_ayc_seller_contacted) AS pom_vis_rtb_ayc_lc_cost_per_seller_contacted

      , SAFE_DIVIDE(pom_vis_rtb_usd_cost, pom_vis_rtb_ayc_timedecay_contact_attribution) AS pom_vis_rtb_ayc_usd_cost_per_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_rtb_usd_cost, pom_vis_rtb_ayc_user_contact) AS pom_vis_rtb_ayc_usd_cost_per_user_contact
      , SAFE_DIVIDE(pom_vis_rtb_usd_cost, pom_vis_rtb_ayc_item_contacted) AS pom_vis_rtb_ayc_usd_cost_per_item_contacted
      , SAFE_DIVIDE(pom_vis_rtb_usd_cost, pom_vis_rtb_ayc_seller_contacted) AS pom_vis_rtb_ayc_usd_cost_per_seller_contacted

   ------------------------
    -- OTHER POM VIS
    ------------------------
      -- leads
      , pom_vis_other_ayc_timedecay_contact_attribution
      , pom_vis_other_ayc_user_contact
      , SAFE_DIVIDE(pom_vis_other_ayc_timedecay_contact_attribution, pom_vis_other_ayc_user_contact) AS avg_pom_vis_other_ayc_contact_per_user
      , pom_vis_other_ayc_user_logg_contact
      , pom_vis_other_ayc_user_not_logg_contact
      , SAFE_DIVIDE(pom_vis_other_ayc_user_logg_contact, ( COALESCE(pom_vis_other_ayc_user_logg_contact, 0) + COALESCE(pom_vis_other_ayc_user_not_logg_contact,0) ) ) AS perc_pom_vis_other_ayc_user_logg_contact
      , SAFE_DIVIDE(pom_vis_other_ayc_user_not_logg_contact, ( COALESCE(pom_vis_other_ayc_user_logg_contact, 0) + COALESCE(pom_vis_other_ayc_user_not_logg_contact,0) ) ) AS perc_pom_vis_other_ayc_user_not_logg_contact
      , pom_vis_other_ayc_item_contacted
      , SAFE_DIVIDE(pom_vis_other_ayc_timedecay_contact_attribution, pom_vis_other_ayc_item_contacted) AS avg_pom_vis_other_ayc_item_contacted
      , pom_vis_other_ayc_seller_contacted
      , SAFE_DIVIDE(pom_vis_other_ayc_timedecay_contact_attribution, pom_vis_other_ayc_seller_contacted) AS avg_pom_vis_other_ayc_seller_contacted

      -- cost clicks impressions
      , SAFE_DIVIDE(pom_vis_other_lc_cost, pom_vis_other_ayc_timedecay_contact_attribution) AS pom_vis_other_ayc_lc_cost_per_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_other_lc_cost, pom_vis_other_ayc_user_contact) AS pom_vis_other_ayc_lc_cost_per_user_contact
      , SAFE_DIVIDE(pom_vis_other_lc_cost, pom_vis_other_ayc_item_contacted) AS pom_vis_other_ayc_lc_cost_per_item_contacted
      , SAFE_DIVIDE(pom_vis_other_lc_cost, pom_vis_other_ayc_seller_contacted) AS pom_vis_other_ayc_lc_cost_per_seller_contacted

      , SAFE_DIVIDE(pom_vis_other_usd_cost, pom_vis_other_ayc_timedecay_contact_attribution) AS pom_vis_other_ayc_usd_cost_per_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_other_usd_cost, pom_vis_other_ayc_user_contact) AS pom_vis_other_ayc_usd_cost_per_user_contact
      , SAFE_DIVIDE(pom_vis_other_usd_cost, pom_vis_other_ayc_item_contacted) AS pom_vis_other_ayc_usd_cost_per_item_contacted
      , SAFE_DIVIDE(pom_vis_other_usd_cost, pom_vis_other_ayc_seller_contacted) AS pom_vis_other_ayc_usd_cost_per_seller_contacted

   ------------------------
    -- XP: contactos CON exclusion
    ------------------------
      -- leads
      , pom_vis_xp_contact_user_con_exclusion_ayc_timedecay_contact_attribution
      , pom_vis_xp_contact_user_con_exclusion_ayc_user_contact
      , SAFE_DIVIDE(pom_vis_xp_contact_user_con_exclusion_ayc_timedecay_contact_attribution, pom_vis_xp_contact_user_con_exclusion_ayc_user_contact) AS avg_pom_vis_xp_contact_user_con_exclusion_ayc_contact_per_user
      , pom_vis_xp_contact_user_con_exclusion_ayc_user_logg_contact
      , pom_vis_xp_contact_user_con_exclusion_ayc_user_not_logg_contact
      , SAFE_DIVIDE(pom_vis_xp_contact_user_con_exclusion_ayc_user_logg_contact, ( COALESCE(pom_vis_xp_contact_user_con_exclusion_ayc_user_logg_contact, 0) + COALESCE(pom_vis_xp_contact_user_con_exclusion_ayc_user_not_logg_contact,0) ) ) AS perc_pom_vis_xp_contact_user_con_exclusion_ayc_user_logg_contact
      , SAFE_DIVIDE(pom_vis_xp_contact_user_con_exclusion_ayc_user_not_logg_contact, ( COALESCE(pom_vis_xp_contact_user_con_exclusion_ayc_user_logg_contact, 0) + COALESCE(pom_vis_xp_contact_user_con_exclusion_ayc_user_not_logg_contact,0) ) ) AS perc_pom_vis_xp_contact_user_con_exclusion_ayc_user_not_logg_contact
      , pom_vis_xp_contact_user_con_exclusion_ayc_item_contacted
      , SAFE_DIVIDE(pom_vis_xp_contact_user_con_exclusion_ayc_timedecay_contact_attribution, pom_vis_xp_contact_user_con_exclusion_ayc_item_contacted) AS avg_pom_vis_xp_contact_user_con_exclusion_ayc_item_contacted
      , pom_vis_xp_contact_user_con_exclusion_ayc_seller_contacted
      , SAFE_DIVIDE(pom_vis_xp_contact_user_con_exclusion_ayc_timedecay_contact_attribution, pom_vis_xp_contact_user_con_exclusion_ayc_seller_contacted) AS avg_pom_vis_xp_contact_user_con_exclusion_ayc_seller_contacted


      -- cost clicks impressions
      , SAFE_DIVIDE(pom_vis_xp_contact_user_con_exclusion_lc_cost, pom_vis_xp_contact_user_con_exclusion_ayc_timedecay_contact_attribution) AS pom_vis_xp_contact_user_con_exclusion_ayc_lc_cost_per_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_xp_contact_user_con_exclusion_lc_cost, pom_vis_xp_contact_user_con_exclusion_ayc_user_contact) AS pom_vis_xp_contact_user_con_exclusion_ayc_lc_cost_per_user_contact
      , SAFE_DIVIDE(pom_vis_xp_contact_user_con_exclusion_lc_cost, pom_vis_xp_contact_user_con_exclusion_ayc_item_contacted) AS pom_vis_xp_contact_user_con_exclusion_ayc_lc_cost_per_item_contacted
      , SAFE_DIVIDE(pom_vis_xp_contact_user_con_exclusion_lc_cost, pom_vis_xp_contact_user_con_exclusion_ayc_seller_contacted) AS pom_vis_xp_contact_user_con_exclusion_ayc_lc_cost_per_seller_contacted

      , SAFE_DIVIDE(pom_vis_xp_contact_user_con_exclusion_usd_cost, pom_vis_xp_contact_user_con_exclusion_ayc_timedecay_contact_attribution) AS pom_vis_xp_contact_user_con_exclusion_ayc_usd_cost_per_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_xp_contact_user_con_exclusion_usd_cost, pom_vis_xp_contact_user_con_exclusion_ayc_user_contact) AS pom_vis_xp_contact_user_con_exclusion_ayc_usd_cost_per_user_contact
      , SAFE_DIVIDE(pom_vis_xp_contact_user_con_exclusion_usd_cost, pom_vis_xp_contact_user_con_exclusion_ayc_item_contacted) AS pom_vis_xp_contact_user_con_exclusion_ayc_usd_cost_per_item_contacted
      , SAFE_DIVIDE(pom_vis_xp_contact_user_con_exclusion_usd_cost, pom_vis_xp_contact_user_con_exclusion_ayc_seller_contacted) AS pom_vis_xp_contact_user_con_exclusion_ayc_usd_cost_per_seller_contacted

   ------------------------
    -- XP: contactos SIN exclusion
    ------------------------
      -- leads
      , pom_vis_xp_contact_user_sin_exclusion_ayc_timedecay_contact_attribution
      , pom_vis_xp_contact_user_sin_exclusion_ayc_user_contact
      , SAFE_DIVIDE(pom_vis_xp_contact_user_sin_exclusion_ayc_timedecay_contact_attribution, pom_vis_xp_contact_user_sin_exclusion_ayc_user_contact) AS avg_pom_vis_xp_contact_user_sin_exclusion_ayc_contact_per_user
      , pom_vis_xp_contact_user_sin_exclusion_ayc_user_logg_contact
      , pom_vis_xp_contact_user_sin_exclusion_ayc_user_not_logg_contact
      , SAFE_DIVIDE(pom_vis_xp_contact_user_sin_exclusion_ayc_user_logg_contact, ( COALESCE(pom_vis_xp_contact_user_sin_exclusion_ayc_user_logg_contact, 0) + COALESCE(pom_vis_xp_contact_user_sin_exclusion_ayc_user_not_logg_contact,0) ) ) AS perc_pom_vis_xp_contact_user_sin_exclusion_ayc_user_logg_contact
      , SAFE_DIVIDE(pom_vis_xp_contact_user_sin_exclusion_ayc_user_not_logg_contact, ( COALESCE(pom_vis_xp_contact_user_sin_exclusion_ayc_user_logg_contact, 0) + COALESCE(pom_vis_xp_contact_user_sin_exclusion_ayc_user_not_logg_contact,0) ) ) AS perc_pom_vis_xp_contact_user_sin_exclusion_ayc_user_not_logg_contact
      , pom_vis_xp_contact_user_sin_exclusion_ayc_item_contacted
      , SAFE_DIVIDE(pom_vis_xp_contact_user_sin_exclusion_ayc_timedecay_contact_attribution, pom_vis_xp_contact_user_sin_exclusion_ayc_item_contacted) AS avg_pom_vis_xp_contact_user_sin_exclusion_ayc_item_contacted
      , pom_vis_xp_contact_user_sin_exclusion_ayc_seller_contacted
      , SAFE_DIVIDE(pom_vis_xp_contact_user_sin_exclusion_ayc_timedecay_contact_attribution, pom_vis_xp_contact_user_sin_exclusion_ayc_seller_contacted) AS avg_pom_vis_xp_contact_user_sin_exclusion_ayc_seller_contacted


      -- cost clicks impressions
      , SAFE_DIVIDE(pom_vis_xp_contact_user_sin_exclusion_lc_cost, pom_vis_xp_contact_user_sin_exclusion_ayc_timedecay_contact_attribution) AS pom_vis_xp_contact_user_sin_exclusion_ayc_lc_cost_per_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_xp_contact_user_sin_exclusion_lc_cost, pom_vis_xp_contact_user_sin_exclusion_ayc_user_contact) AS pom_vis_xp_contact_user_sin_exclusion_ayc_lc_cost_per_user_contact
      , SAFE_DIVIDE(pom_vis_xp_contact_user_sin_exclusion_lc_cost, pom_vis_xp_contact_user_sin_exclusion_ayc_item_contacted) AS pom_vis_xp_contact_user_sin_exclusion_ayc_lc_cost_per_item_contacted
      , SAFE_DIVIDE(pom_vis_xp_contact_user_sin_exclusion_lc_cost, pom_vis_xp_contact_user_sin_exclusion_ayc_seller_contacted) AS pom_vis_xp_contact_user_sin_exclusion_ayc_lc_cost_per_seller_contacted

      , SAFE_DIVIDE(pom_vis_xp_contact_user_sin_exclusion_usd_cost, pom_vis_xp_contact_user_sin_exclusion_ayc_timedecay_contact_attribution) AS pom_vis_xp_contact_user_sin_exclusion_ayc_usd_cost_per_timedecay_contact_attribution
      , SAFE_DIVIDE(pom_vis_xp_contact_user_sin_exclusion_usd_cost, pom_vis_xp_contact_user_sin_exclusion_ayc_user_contact) AS pom_vis_xp_contact_user_sin_exclusion_ayc_usd_cost_per_user_contact
      , SAFE_DIVIDE(pom_vis_xp_contact_user_sin_exclusion_usd_cost, pom_vis_xp_contact_user_sin_exclusion_ayc_item_contacted) AS pom_vis_xp_contact_user_sin_exclusion_ayc_usd_cost_per_item_contacted
      , SAFE_DIVIDE(pom_vis_xp_contact_user_sin_exclusion_usd_cost, pom_vis_xp_contact_user_sin_exclusion_ayc_seller_contacted) AS pom_vis_xp_contact_user_sin_exclusion_ayc_usd_cost_per_seller_contacted


FROM matt_attribution AS A

LEFT JOIN matt_inbound AS B
ON A.sit_site_id = B.sit_site_id
AND A.period = B.period



LEFT JOIN cost_agrupado AS C
ON A.sit_site_id = C.sit_site_id
AND A.period = C.period


ORDER BY 1,2,3
;
